---
title: "Supplementary material - S2: Extreme policy-condition tests"
author: "Simon Chiu"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
---

```{r setup1, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
gc()

library(progress)
library(tidyverse)
library(openxlsx)
library(ggplot2)
library(patchwork)
library(ggh4x)
library(ggpubr)
library(ggbrace)
library(scales)

# devtools::install_github("nicolash2/ggbrace")

focus_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/focus_df_2023-07-18.RDS")
sensitivity_ran_variables<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/sensitivity_ran_variables_2023-07-17.RDS")
det_bmi_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/det_bmi_df_2023-07-16.RDS") %>%
rename("bmi.output"="bmi", "age.groups.output"="age.groups", "gender.output"="gender")
det_bmi_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/det_bmi_df_2023-07-16.RDS") %>%
rename("bmi.output"="bmi", "age.groups.output"="age.groups", "gender.output"="gender")
load("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_seq_sample_2023-07-16.RData")
lsa_bmi_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_bmi_df_2023-07-18.RDS")

lsa.sensivity.seq.sample<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_sensivity_seq_sample_2023-07-17.RDS")


focus_df_epoch<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/focus_df_epoch_2023-07-16.RDS")
focus_df_cci<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/focus_df_cci_2023-07-16.RDS")
focus_df_si<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/focus_df_si_2023-07-16.RDS")
focus_df_svi<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/focus_df_svi_2023-07-16.RDS")
focus_df_ssb<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/focus_df_ssb_2023-07-16.RDS")

lsa_int_epoch_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_epoch_df_2023-08-13.RDS")
lsa_int_cci_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_cci_df_2023-08-13.RDS")
lsa_int_si_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_si_df_2023-08-13.RDS")
lsa_int_svi_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_svi_df_2023-08-13.RDS")
lsa_int_ssb_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_ssb_df_2023-08-13.RDS")

derivative_lsa_epoch_int<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_epoch_int_2023-08-13.RDS")
derivative_lsa_cci_int<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_cci_int_2023-08-13.RDS")
derivative_lsa_si_int<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_si_int_2023-08-13.RDS")
derivative_lsa_svi_int<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_svi_int_2023-08-13.RDS")
derivative_lsa_ssb_int<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_ssb_int_2023-08-13.RDS")

det_bmi_df_wide<-det_bmi_df %>% 
filter(scenario!="Base model") %>% 
rename('det.int.value'='2057') %>% 
select("scenario" ,"run","bmi.output","age.groups.output","gender.output", "det.int.value") %>% 
left_join(., det_bmi_df %>% 
            filter(scenario=="Base model") %>% 
            rename('det.base.model.value'='2057') %>% 
            select("bmi.output","age.groups.output","gender.output", "det.base.model.value"),
          by=c("bmi.output","age.groups.output","gender.output"))

lsa_int_epoch_df<-lsa_int_epoch_df %>% 
mutate(scenario=factor(case_when(scenario == "1 EPOCH"~1,
                               scenario == "2 CCI"~2,
                               scenario == "3 SI"~3,
                               scenario == "4 SVI"~4,
                               scenario == "5 SSB"~5,
                               scenario == "6 EPOCH CCI"~6,
                               scenario == "7 SI SVI"~7,
                               scenario == "8 EPOCH CCI SI SVI"~8,
                               scenario == "9 EPOCH CCI SI SVI SSB"~9),
                     levels=c(1:9),
                     labels = c("EPOCH", "CCI", "SI", "SVI", "SSB", "EPOCH+CCI",
                                "SI+SVI",  "EPOCH+CCI+SI+SVI", "EPOCH+CCI+SI+SVI+SSB"))) %>% 
left_join(., det_bmi_df_wide %>% select(-run),
        by=c("scenario","bmi.output","age.groups.output","gender.output"))

lsa_int_cci_df<-lsa_int_cci_df %>% 
mutate(scenario=factor(case_when(scenario == "1 EPOCH"~1,
                               scenario == "2 CCI"~2,
                               scenario == "3 SI"~3,
                               scenario == "4 SVI"~4,
                               scenario == "5 SSB"~5,
                               scenario == "6 EPOCH CCI"~6,
                               scenario == "7 SI SVI"~7,
                               scenario == "8 EPOCH CCI SI SVI"~8,
                               scenario == "9 EPOCH CCI SI SVI SSB"~9),
                     levels=c(1:9),
                     labels = c("EPOCH", "CCI", "SI", "SVI", "SSB", "EPOCH+CCI",
                                "SI+SVI",  "EPOCH+CCI+SI+SVI", "EPOCH+CCI+SI+SVI+SSB"))) %>% 
left_join(., det_bmi_df_wide %>% select(-run),
        by=c("scenario","bmi.output","age.groups.output","gender.output"))

lsa_int_si_df<-lsa_int_si_df %>% 
mutate(scenario=factor(case_when(scenario == "1 EPOCH"~1,
                               scenario == "2 CCI"~2,
                               scenario == "3 SI"~3,
                               scenario == "4 SVI"~4,
                               scenario == "5 SSB"~5,
                               scenario == "6 EPOCH CCI"~6,
                               scenario == "7 SI SVI"~7,
                               scenario == "8 EPOCH CCI SI SVI"~8,
                               scenario == "9 EPOCH CCI SI SVI SSB"~9),
                     levels=c(1:9),
                     labels = c("EPOCH", "CCI", "SI", "SVI", "SSB", "EPOCH+CCI",
                                "SI+SVI",  "EPOCH+CCI+SI+SVI", "EPOCH+CCI+SI+SVI+SSB"))) %>% 
left_join(., det_bmi_df_wide %>% select(-run),
        by=c("scenario","bmi.output","age.groups.output","gender.output"))

lsa_int_svi_df<-lsa_int_svi_df %>% 
mutate(scenario=factor(case_when(scenario == "1 EPOCH"~1,
                               scenario == "2 CCI"~2,
                               scenario == "3 SI"~3,
                               scenario == "4 SVI"~4,
                               scenario == "5 SSB"~5,
                               scenario == "6 EPOCH CCI"~6,
                               scenario == "7 SI SVI"~7,
                               scenario == "8 EPOCH CCI SI SVI"~8,
                               scenario == "9 EPOCH CCI SI SVI SSB"~9),
                     levels=c(1:9),
                     labels = c("EPOCH", "CCI", "SI", "SVI", "SSB", "EPOCH+CCI",
                                "SI+SVI",  "EPOCH+CCI+SI+SVI", "EPOCH+CCI+SI+SVI+SSB"))) %>% 
left_join(., det_bmi_df_wide %>% select(-run),
        by=c("scenario","bmi.output","age.groups.output","gender.output"))

lsa_int_ssb_df<-lsa_int_ssb_df %>% 
mutate(scenario=factor(case_when(scenario == "1 EPOCH"~1,
                               scenario == "2 CCI"~2,
                               scenario == "3 SI"~3,
                               scenario == "4 SVI"~4,
                               scenario == "5 SSB"~5,
                               scenario == "6 EPOCH CCI"~6,
                               scenario == "7 SI SVI"~7,
                               scenario == "8 EPOCH CCI SI SVI"~8,
                               scenario == "9 EPOCH CCI SI SVI SSB"~9),
                     levels=c(1:9),
                     labels = c("EPOCH", "CCI", "SI", "SVI", "SSB", "EPOCH+CCI",
                                "SI+SVI",  "EPOCH+CCI+SI+SVI", "EPOCH+CCI+SI+SVI+SSB"))) %>% 
left_join(., det_bmi_df_wide %>% select(-run),
        by=c("scenario","bmi.output","age.groups.output","gender.output"))


lsa_basemodel_epoch_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_basemodel_epoch_df_summary_2023-08-12.RDS")
lsa_basemodel_cci_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_basemodel_cci_df_summary_2023-08-12.RDS")
lsa_basemodel_si_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_basemodel_si_df_summary_2023-08-12.RDS")
lsa_basemodel_svi_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_basemodel_svi_df_summary_2023-08-12.RDS")
lsa_basemodel_ssb_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_basemodel_ssb_df_summary_2023-08-12.RDS")

df_summary<-
lsa_basemodel_epoch_df_summary %>% 
add_case(lsa_basemodel_cci_df_summary) %>% 
add_case(lsa_basemodel_si_df_summary) %>% 
add_case(lsa_basemodel_svi_df_summary) %>% 
add_case(lsa_basemodel_ssb_df_summary) %>% 
mutate(scenario=factor(case_when(scenario == "EPOCH"~1,
                               scenario == "CCI"~2,
                               scenario == "SI"~3,
                               scenario == "SVI"~4,
                               scenario == "SSB"~5,
                               scenario == "EPOCH+CCI"~6,
                               scenario == "SI+SVI"~7,
                               scenario == "EPOCH+CCI+SI+SVI"~8,
                               scenario == "EPOCH+CCI+SI+SVI+SSB"~9),
                     levels=c(1:9),
                     labels = c("EPOCH", "CCI", "SI", "SVI", "SSB", "EPOCH+CCI",
                                "SI+SVI",  "EPOCH+CCI+SI+SVI", "EPOCH+CCI+SI+SVI+SSB"))) %>% 
rename("Gender input"="gender.input", "Gender outcome"="gender.output", 
       "Age input"="age.groups.input", "BMI outcome"="bmi.output",
       "BMI input"="bmi.input")

# combined.sugar.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/combined_sugar_int_df.RDS")

# epoch.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_epoch_df_2023-08-13.RDS")
# cci.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_cci_df_2023-08-13.RDS")
# si.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_si_df_2023-08-13.RDS")
# svi.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_svi_df_2023-08-13.RDS")
# ssb.int.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_ssb_df_2023-08-13.RDS")


lsa_int_epoch_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_epoch_df_summary_2023-08-15.RDS")
lsa_int_cci_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_cci_df_summary_2023-08-16.RDS")
lsa_int_si_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_si_df_summary_2023-08-16.RDS")
lsa_int_svi_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_svi_df_summary_2023-08-16.RDS")
lsa_int_ssb_df_summary<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_int_ssb_df_summary_2023-08-16.RDS")



```

```{r setup2, include=FALSE}
# READ DATA IN FOR INTERACTIONS

# knitr::opts_chunk$set(echo = TRUE)

# rm(list=ls())
gc()

# library(progress)
# library(tidyverse)
# library(openxlsx)
# library(ggplot2)
# library(patchwork)
# library(ggh4x)
# library(ggpubr)
# library(ggbrace)
# library(scales)




derivative.lsa<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_2023-08-09.RDS")

derivative.lsa.epoch<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_epoch_2023-08-09.RDS")
derivative.lsa.cci<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_cci_2023-08-09.RDS")
derivative.lsa.si<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_si_2023-08-09.RDS")
derivative.lsa.svi<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_svi_2023-08-09.RDS")
derivative.lsa.ssb<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_ssb_2023-08-09.RDS")

lsa_bmi_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_bmi_df_2023-07-29.RDS")

plot.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/comparison_data_2023-07-28.RDS") %>%
rename("BMI output"="bmi.output")

focus_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/focus_df_2023-07-18.RDS")

list.of.focus.variables<-focus_df %>% 
arrange(focus.title, gender.input, bmi.input, age.groups.input) %>% 
select(focus.title) %>% 
group_by(focus.title) %>% filter(row_number()==1)%>% data.frame()

list.of.focus.variables.levels<-focus_df %>% 
arrange(focus.title, gender.input, bmi.input, age.groups.input) %>% 
select(focus) %>% 
group_by(focus) %>% filter(row_number()==1)%>% data.frame()

list.of.focus.variables.levels.plot.search<-focus_df %>% 
# filter(is.na(age.groups.input) |
#        age.groups.input=="Age 2" |
#        grepl("Age 9 11", age.groups.input) | 
#        grepl("Age 18 19", age.groups.input)) %>% 
# arrange(focus.title, gender.input, bmi.input, age.groups.input) %>% 
arrange(focus.title, age.groups.input) %>% 
# select(focus, focus.title) %>% 
group_by(focus) %>% filter(row_number()==1)%>% data.frame()



derivative.lsa.combined<-
derivative.lsa.epoch %>% mutate(scenario="1 EPOCH") %>% 
add_case(derivative.lsa.cci %>% mutate(scenario="2 CCI")) %>%
add_case(derivative.lsa.si %>% mutate(scenario="3 SI")) %>%
add_case(derivative.lsa.svi %>% mutate(scenario="4 SVI")) %>%
add_case(derivative.lsa.ssb %>% mutate(scenario="5 SSB")) %>%
mutate(scenario=factor(case_when(scenario == "1 EPOCH"~1,
                               scenario == "2 CCI"~2,
                               scenario == "3 SI"~3,
                               scenario == "4 SVI"~4,
                               scenario == "5 SSB"~5,
                               scenario == "6 EPOCH CCI"~6,
                               scenario == "7 SI SVI"~7,
                               scenario == "8 EPOCH CCI SI SVI"~8,
                               scenario == "9 EPOCH CCI SI SVI SSB"~9),
                     levels=c(1:9),
                     labels = c("EPOCH", "CCI", "SI", "SVI", "SSB", "EPOCH+CCI",
                                "SI+SVI",  "EPOCH+CCI+SI+SVI", "EPOCH+CCI+SI+SVI+SSB"))) %>% 
rename("Gender input"="gender.input", "Gender outcome"="gender.output", 
       "Age input"="age.groups.input", "BMI outcome"="bmi.output",
       "BMI input"="bmi.input")


load("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity//Data/R/lsa_seq_sample_2023-07-16.RData")




```



# Introduction
This document presents the results assessing the impact of extreme policy condition sensitivity analysis for the **D**c**i**sion **S**upport tool for **C**hild and **A**dolescence **O**besity, a system dynamic model developed to explore underlying relationships that contribute to youth obesity.

## Outline of extreme policy test sensitivity analysis

Extreme policy test is a stress test on how input parameters and policy input assumptions impact the estimated change in overweight and obesity from policy intervention.

# Methods

The base model assumptions' sensitivity analysis was assessed with each policy scenario applied.

For each policy scenario, a sensitivity analysis tested 649 input variables between $\pm$ 20% of an input's initial value. For each sensitivity analysis, the model-generated BMI prevalence outcomes are compared to the sensitivity analysis where the scenario is not tested (base model sensitivity)

Elementary Effect (EE) was used to summarise model outcomes; these summaries are used to examine model behaviour. Where variables are looked to be highlighted as influential, individual input-output relationships plots disaggregate the summary results to examine behaviours further.

## Outcome Measure

The plot below describes how Elementary Effect (EE) are used to summarise sensitivity analysis results.

Panel A shows an example of a model-generated outcome, over modelled time, with a scenario implemented. The input assumptions ($x$) are varied between $\pm$ 20% of its initial value and a policy scenario that reduces the outcome. Panel B compares the base model and policy implementation for the different assumptions.

The model results at the end of the model are used to calculate the EE (panel B).

The EE is calculated for each difference between the base model and policy intervention to create a sample of EE. The mean and standard deviation summarises the change in outcome per percentage point shift in input assumption. 


$$ EE_{i} = \frac{f(x-\Delta_{i})- f(x)}{\Delta_{i}}$$

$$ \mu_{EE}= \frac{1}{n} \sum_{i=1}^{n} EE_{i}, \hspace{1cm} \sigma_{EE}=\frac{1}{(n-1)} \sum_{i=1}^{n} (EE_{i} - \mu_{EE})^2$$

```{r, echo=F, message=FALSE, warning=F, error=F, fig.height=1*3*6, fig.width=1.3*1*6, fig.cap="Example plot for analysis outcome"}
cc <- scales::seq_gradient_pal("blue", "red", "Lab")(seq(0,1,length.out=6))
x2=0
x3=0.04

# x4=0.5
# x5=0.01
x4=0.07

data.frame(x=seq(0,50, 0.1)) %>% 
mutate(`Base model`=(0.3/(1+exp(-(1/10)*(x-15))))) %>% 
mutate(effect1=ifelse(x>0,`Base model`*(1-((x2-x3*9))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect2=ifelse(x>0,`Base model`*(1-((x2-x3*6))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect3=ifelse(x>0,`Base model`*(1-((x2-x3*3))/(1+exp(-1*(0)))), NA)) %>% 
mutate(`Initial assumptions`=ifelse(x>0,`Base model`*(1+((x2))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect5=ifelse(x>0,`Base model`*(1-((x2+x3*3))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect6=ifelse(x>0,`Base model`*(1-((x2+x3*6))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect7=ifelse(x>0,`Base model`*(1-((x2+x3*9))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(int.effect1=ifelse(x>12,effect1*(1-(x4*1.2/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect2=ifelse(x>12,effect2*(1-(x4*1.25/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect3=ifelse(x>12,effect3*(1-(x4*1.25/(1+exp(-(x-20))))), NA)) %>% 
mutate(`Initial intervention assumptions`=ifelse(x>12,`Initial assumptions`*(1-(x4*1/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect5=ifelse(x>12,effect5*(1-(x4*0.9/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect6=ifelse(x>12,effect6*(1-(x4*0.78/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect7=ifelse(x>12,effect7*(1-(x4*0.8/(1+exp(-(x-20))))), NA)) %>%
gather(., type,y,`Base model`:int.effect7) %>% 
  mutate(type2=ifelse(grepl("int", type), "Intervention", "Base model")) %>% 
  mutate(type=factor(case_when(type=="Base model"~1,
                      type=="Initial assumptions"~2,
                      type=="effect1"~3,
                      type=="effect2"~4,
                      type=="effect3"~5,
                      type=="effect5"~6,
                      type=="effect6"~7,
                      type=="effect7"~8,
                      type=="Initial intervention assumptions"~2,
                      type=="int.effect1"~3,
                      type=="int.effect2"~4,
                      type=="int.effect3"~5,
                      type=="int.effect5"~6,
                      type=="int.effect6"~7,
                      type=="int.effect7"~8),
                    levels=c(1,2,3,4,5,6,7,8),
       labels=c("Base model", "Intervention Initial assumptions",
                             paste0("x=",sprintf("%0.1f",-20)),paste0("x=",sprintf("%0.1f",-13)),paste0("x=",sprintf("%0.1f",-6)),
                           paste0("x=",sprintf("%0.1f",6)),paste0("x=",sprintf("%0.1f",13)),paste0("x=",sprintf("%0.1f",20))))) %>%
mutate(y.point=ifelse(x==50, y, NA)) %>%
ggplot()+
geom_point(aes(x=x, y=y.point,  fill=type, group=y.point), shape=21)+
geom_line(aes(x=x, y=y, color=type, linetype=type2), show.legend = F)+
scale_y_continuous(limits = c(0, 0.4), label=scales::percent)+
scale_fill_manual(values=c("black", "black", cc))+
scale_color_manual(values=c("black", "black", cc))+
scale_linetype_manual(values=c(rep(c("solid", "dashed"), 7)))+
theme_bw()+
guides(fill = guide_legend("Model run"),
       linetype = guide_legend("Model run"))+
ylab("Model-generated outcome \n BMI prevalence (%)")+xlab("Modelled time")+
theme(legend.position = "bottom")+

data.frame(x=seq(0,50, 0.1)) %>% 
mutate(`Base model`=(0.3/(1+exp(-(1/10)*(x-15))))) %>% 
mutate(effect1=ifelse(x>0,`Base model`*(1-((x2-x3*9))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect2=ifelse(x>0,`Base model`*(1-((x2-x3*6))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect3=ifelse(x>0,`Base model`*(1-((x2-x3*3))/(1+exp(-1*(0)))), NA)) %>% 
mutate(`Initial assumptions`=ifelse(x>0,`Base model`*(1+((x2))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect5=ifelse(x>0,`Base model`*(1-((x2+x3*3))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect6=ifelse(x>0,`Base model`*(1-((x2+x3*6))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect7=ifelse(x>0,`Base model`*(1-((x2+x3*9))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(int.effect1=ifelse(x>12,effect1*(1-(x4*1.2/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect2=ifelse(x>12,effect2*(1-(x4*1.25/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect3=ifelse(x>12,effect3*(1-(x4*1.25/(1+exp(-(x-20))))), NA)) %>% 
mutate(`Initial intervention assumptions`=ifelse(x>12,`Initial assumptions`*(1-(x4*1/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect5=ifelse(x>12,effect5*(1-(x4*0.9/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect6=ifelse(x>12,effect6*(1-(x4*0.78/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect7=ifelse(x>12,effect7*(1-(x4*0.8/(1+exp(-(x-20))))), NA)) %>%
mutate(`Base model`=`Base model`-`Base model`,
       int.effect1=int.effect1-effect1,
       int.effect2=int.effect2-effect2,
       int.effect3=int.effect3-effect3,
       `Initial intervention assumptions`=`Initial intervention assumptions`-`Initial assumptions`,
       int.effect5=int.effect5-effect5,
       int.effect6=int.effect6-effect6,
       int.effect7=int.effect7-effect7) %>%
select(x,`Base model`, int.effect1, int.effect2, int.effect3, `Initial intervention assumptions`,
       int.effect5, int.effect6, int.effect7) %>% 
  gather(., type,y,`Base model`:int.effect7) %>% 
mutate(type=factor(case_when(type=="Base model"~1,
                      type=="Initial intervention assumptions"~2,
                      type=="int.effect1"~3,
                      type=="int.effect2"~4,
                      type=="int.effect3"~5,
                      type=="int.effect5"~6,
                      type=="int.effect6"~7,
                      type=="int.effect7"~8),
                    levels=c(1,2,3,4,5,6,7,8),
       labels=c("Base model", "Intervention Initial assumptions",
                             paste0("x=",sprintf("%0.1f",-20)),paste0("x=",sprintf("%0.1f",-13)),paste0("x=",sprintf("%0.1f",-6)),
                           paste0("x=",sprintf("%0.1f",6)),paste0("x=",sprintf("%0.1f",13)),paste0("x=",sprintf("%0.1f",20))))) %>% 
mutate(y.point=ifelse(x==50, y, NA)) %>%
ggplot()+
geom_point(aes(x=x, y=y.point, fill=type), shape=21)+
geom_line(aes(x=x, y=y, color=type, linetype=type, alpha=type))+
scale_color_manual(values=c("black","black", "#0000FF", "#8D00CE", "#BA009F", "#D70072", "#ED0044", "#FF0000"))+
scale_fill_manual(values=c("black", "black","#0000FF", "#8D00CE", "#BA009F", "#D70072", "#ED0044", "#FF0000"))+
scale_y_continuous(labels = scales::percent)+
scale_linetype_manual(values=c(1,1, rep(2, 6)))+
scale_alpha_manual(values=c(1,1, rep(1, 6)))+
theme_bw()+
guides(colour = guide_legend("Model run"),
       linetype = guide_legend("Model run"),
       alpha = guide_legend("Model run"),
       fill = guide_legend("Model run"))+
ylab("Change in outcome prevalence (%)")+xlab("Modelled time")+
  theme(legend.position = "bottom")+
ggtitle("Intervention benefit")+

data.frame(x=seq(0,50, 0.1)) %>% 
mutate(`Base model`=(0.3/(1+exp(-(1/10)*(x-15))))) %>% 
mutate(effect1=ifelse(x>0,`Base model`*(1-((x2-x3*9))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect2=ifelse(x>0,`Base model`*(1-((x2-x3*6))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect3=ifelse(x>0,`Base model`*(1-((x2-x3*3))/(1+exp(-1*(0)))), NA)) %>% 
mutate(`Initial assumptions`=ifelse(x>0,`Base model`*(1+((x2))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect5=ifelse(x>0,`Base model`*(1-((x2+x3*3))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect6=ifelse(x>0,`Base model`*(1-((x2+x3*6))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(effect7=ifelse(x>0,`Base model`*(1-((x2+x3*9))/(1+exp(-1*(x-0)))), NA)) %>% 
mutate(int.effect1=ifelse(x>12,effect1*(1-(x4*1.2/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect2=ifelse(x>12,effect2*(1-(x4*1.25/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect3=ifelse(x>12,effect3*(1-(x4*1.25/(1+exp(-(x-20))))), NA)) %>% 
mutate(`Initial intervention assumptions`=ifelse(x>12,`Initial assumptions`*(1-(x4*1/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect5=ifelse(x>12,effect5*(1-(x4*0.9/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect6=ifelse(x>12,effect6*(1-(x4*0.78/(1+exp(-(x-20))))), NA)) %>% 
mutate(int.effect7=ifelse(x>12,effect7*(1-(x4*0.8/(1+exp(-(x-20))))), NA)) %>%
mutate(`Base model`=`Base model`-`Base model`,
       int.effect1=int.effect1-effect1,
       int.effect2=int.effect2-effect2,
       int.effect3=int.effect3-effect3,
       `Initial intervention assumptions`=`Initial intervention assumptions`-`Initial assumptions`,
       int.effect5=int.effect5-effect5,
       int.effect6=int.effect6-effect6,
       int.effect7=int.effect7-effect7) %>%
select(x,`Base model`, int.effect1, int.effect2, int.effect3, `Initial intervention assumptions`,
       int.effect5, int.effect6, int.effect7) %>% 
  gather(., type,y,`Base model`:int.effect7)  %>% 
mutate(y.point=ifelse(x==50, y, NA))  %>% 
filter(x==50) %>% 
filter(type!="Base model") %>%
mutate(type=case_when(type=="Initial intervention assumptions"~x2,
                      type=="int.effect1"~x2-x3*9,
                      type=="int.effect2"~x2-x3*6,
                      type=="int.effect3"~x2-x3*3,
                      type=="int.effect5"~x2+x3*3,
                      type=="int.effect6"~x2+x3*6,
                      type=="int.effect7"~x2+x3*9)) %>% 
mutate(type=as.numeric(type), type.color=c("-20%", "-13%", "-6%", "0%", "6%", "13%", "20%")) %>% 
ggplot()+
geom_point(aes(x=type, y=y, fill=type.color), shape=21)+
geom_line(aes(x=type, y=y), alpha=0.1)+
geom_hline(aes(yintercept=0), color="black", alpha=0.3)+
xlab("x")+ylab("Change in outcome prevalence (%) \n at the end of the model")+
scale_x_continuous(breaks=c(-0.36, -0.24, -0.12, 0.00, 0.12	, 0.24, 0.36),
labels = c("-20%", "-13%", "-6%", "Initial assumption", "6%", "13%", "20%"))+
scale_y_continuous(limits = c(-0.04, 0), labels = scales::percent)+
scale_color_manual(values=c("#0000FF", "#8D00CE", "#BA009F", "black", "#D70072", "#ED0044", "#FF0000"))+
scale_fill_manual(values=c("#0000FF", "#8D00CE", "#BA009F", "black", "#D70072", "#ED0044", "#FF0000"))+
guides(fill = guide_legend("Input assumption (x)"))+
theme_bw()+
theme(legend.position = "bottom")+
ggbrace::geom_brace(aes(x=c(0+0.007,0+0.007+0.02), y=c(-0.02038444	, -0.02700939		)),rotate=90, inherit.data=F)+
ggbrace::geom_brace(aes(x=c(-0.12,0), y=c(-0.02700939-0.0005	, -0.02700939-0.002)),rotate=180, inherit.data=F)+
annotate("text", x = 0.09, y = -0.0238, parse = T, label = as.character(expression("f("*x*"+"*Delta*")-f(x)")))+
annotate("text", x = -0.1245+0.12/2, y = -0.0305, parse = T, label = as.character(expression(~Delta)))+
annotate("text", x = 0.12, y = -0.031, parse = T, label = as.character(expression(paste(EE," = ",frac("f(x+"*Delta*")-f(x)", ~Delta)))))+
guides(colour = guide_legend("Input assumption (x)"), labels = label_scientific( scale =1,suffix = "%"))+
ggtitle("Intervention benefit at time 50")+

plot_layout(ncol=1, nrow=3)+
plot_annotation(tag_levels = list(c("A", "B", "C")))&
theme(legend.position = "bottom")
```

## How to interpret the results

In the definition of each policy intervention, there is an assumption that the published health effects on the system are not fully realised when scaling up the intervention to a national rollout. This loss of fidelity can be attributed to changes in the implementation characteristics to accommodate large-scale programs, differences in strength of effect as the intervention is no longer being project managed as a research program or lapse in adherence to policy protocol in larger settings without specially trained staff.

Initially, each policy assumes that 30% of published health effect is lost due to scale-up. This is implemented in the model as a multiplicative factor where the change in underlying behaviours is multiplied by 0.7.

Panel A in the below figure shows the summary results of the sensitivity analysis testing the impact of the scale-up factor for early prevention of childhood obesity intervention in the model. The summary indicates that this assumption primarily impacts the policy effect for the two youngest age groups, 2-year-olds and 3-5-year-olds. Child and adolescent age groups have little difference, with all impacts gone by 30 years old.

The individual relationships in panel B show the direct relationship between scale-up factors and reduction in obesity for each age group. The intervention effect on the prevalence of overweight and obesity is negatively associated with the scale-up factor. That is, as the policy has a higher fidelity, achieving a similar effect as was observed in an RCT, overweight and obesity are reduced. Conversely, larger scale up increases the prevalence of underweight and healthy weight. The negative slopes in the 2-year-olds and 3-5-year-olds results in the negative summary statistics in the summary plot (panel A).

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*4.5*2.2}
# EPOCH.ran.variables %>%
#   filter(label=="EPOCH Scale up factor")

p.tmp1<-derivative_lsa_epoch_int %>%
filter(focus=="EPOCH Scale up factor") %>% 
# filter(gender.input=='Male' & age.groups.input=="Age 6 8" & bmi.input=="Overweight") %>%
filter(gender.output=='Male') %>%
filter(age.groups.output!="Age 45 49") %>% 
# filter(as.numeric(age.groups.input)<=6) %>% 
rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output, alpha=bmi.output), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output, alpha=bmi.output))+
# geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output), se=F, linewidth=0.5)+
# facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
# scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                  labels=c("3-5", "18-19", "40-44"))+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
scale_alpha_manual(values=c(1,1,1), )+
ylab(bquote(atop("Average change in BMI %", "per PP change in input assumption (" *mu[EE]*")")))+
guides(colour = guide_legend("BMI outcomes"), alpha = "none")+
ggtitle("Summary plot - Mean Elementary Effect by age",subtitle="Male outcomes")+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))


p.tmp2<-lsa_int_epoch_df %>% ungroup() %>% 
filter(year==2057) %>% 
filter(focus=="EPOCH Scale up factor") %>% 
rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input", 
       "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
mutate(`BMI outcome2`=factor(case_when(`BMI outcome`=="Underweight & \n Healthy weight"~1,
                                       `BMI outcome`=="Overweight"~2,
                                       `BMI outcome`=="With obesity"~3),
                             levels=c(1,2,3), labels=c("Underweight & \n Healthy weight","Overweight","With obesity"),
                             ordered = T)) %>% 
# select(`BMI outcome`, `BMI outcome2`) %>% table
filter(`Gender outcome`=='Male') %>%
# filter(`BMI outcome`=="With obesity") %>% 
filter(`Age output`!="Age 45 49") %>%
mutate(prop=input.value*100/initial.input) %>% 
ggplot()+
geom_line(aes(x=prop-100, y=diff, color=`BMI outcome`), se=F, linewidth=0.5, span=0.25)+
# geom_smooth(aes(x=prop-100, y=diff, color=`BMI outcome2`), se=F, linewidth=0.5, span=0.25)+
# geom_vline(aes(xintercept=0, color="Initial assumption"), linetype="dashed", alpha=0.3)+
facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
# scale_colour_manual(values = c("black", hue_pal()(3)))+
guides(colour = guide_legend(" "))+
scale_y_continuous(labels = scales::percent)+
  # scale_x_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1),
  #                  limits = c(-20, 20))+
scale_x_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1),
                   limits = c(-20, 20),
                   sec.axis = sec_axis(~(.+100)*0.7/100,
                                       name = "\n Scale up factor \n",
                                       labels =scales::label_number(suffix = "", accuracy = 0.1)))+
ylab("Change in Prevalence of BMI category")+
xlab(" \n Percentage of initial assumed EPOCH Scale up factor")+
ggtitle("Individual relationships", subtitle = "Prevalence of obesity vs EPOCH Scale up factor")+
  theme_bw() +theme(legend.position = "bottom",
                    panel.spacing.y =unit(0, "mm"),
                    panel.spacing.x =unit(4, "mm"),
                    plot.title = element_text(face = c("bold")),
                    plot.subtitle = element_text())

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout, tag_level = "keep")+
plot_annotation(tag_levels = list(c("A", "B")))&
theme(legend.position = "bottom")

```

# Results
## Overaching summary

The results are separated into two sections; the first section examines how policy-specific input impacts the estimated health benefit from each policy. These include policy definitions affecting fidelity, exposure and estimated behaviour effects. The second sections of the results examine how the base model assumptions impact the estimated health effects for each policy. In this section, all assumptions for policy definitions are kept at their initial values.

An example of the interaction between policy and base model assumptions is described below; here, carbohydrates' assumed thermic effect (TEF) is varied and policies are tested for each input assumption.

For each of the interventions tested, there is a positive association between TEF and the change in obesity, showing that higher assumed values of TEF result in a higher prevalence of obesity and lower health benefit from each intervention.

While this might be logical for interventions that directly impact dietary behaviours of food groups with a high composition of carbohydrates, this result is unintuitive for interventions that do not impact a cohorts diets. For example, sports vouchers have no impact on diet, yet changes in this dietary definition affect this intervention's perceived success.

### Example of interactions occuring between base model assumptions and interventions
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.2*4*2.5,fig.height=1*5*2.5}
# list.of.focus.variables.levels.plot.search %>% 
# filter(focus.title=="CARBOHYDRATE TEF" )
p.tmp1<-derivative.lsa.combined %>%
filter(focus.title=="CARBOHYDRATE TEF" ) %>% 
# filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
# filter(`BMI input`=="Overweight") %>% 
  filter(age.groups.output!="Age 45 49") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario), show.legend = F)+
# facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age")+
ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 plot.title = element_text(face = c("bold")),
                 plot.subtitle = element_text(),
                 strip.text = element_text(size = 7),
                 # axis.title.y = element_text(size=7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
 ggtitle("Summary plot - Mean Elementary Effect by age",subtitle="Male outcomes")

p.tmp2<-plot.df %>% 
 rename("Gender input"="gender.input", "BMI outcome"="BMI output", "BMI input"="bmi.input", "Age input"="age.groups.input") %>%
filter(focus.title=="CARBOHYDRATE TEF" ) %>% 
# filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
# filter(`BMI input`=="Overweight") %>%
filter(`Age output`!="Age 45 49") %>% 
mutate(prop=((input.value/initial.input)-1)*100)%>% 
ggplot()+
  geom_smooth(aes(x=prop, y=diff, color=scenario), se=F, linewidth=0.5)+
 facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  facet_wrap(vars(`Age output`), scales="free", ncol = 4, nrow=3)+
guides(colour = guide_legend("Scenario"),
       linetype = guide_legend("Scenario"),
       alpha = guide_legend("Scenario"))+
scale_y_continuous(labels = scales::percent)+
scale_x_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1), limits = c(-20, 20),
                   sec.axis = sec_axis(~(.+100)*0.1238/100, name = "TEF", labels = scales::label_number(suffix = "")))+
ggtitle("Individual relationships", subtitle = "Prevalence of obesity vs assumed Carbohydrate (TEF)")+
ylab("Change in the prevalence of obesity (%)")+xlab("Percentage change in assumed Carbohydrate (TEF)")+
    theme_bw() +theme(legend.position = "bottom",
                    panel.spacing.y =unit(0, "mm"),
                    panel.spacing.x =unit(4, "mm"),
                    plot.title = element_text(face = c("bold")),
                    plot.subtitle = element_text())

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)&
# plot_annotation(title = 'Break down of summary results',
#                  theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
theme(legend.position = "bottom")

```

## Why interactions occur

From investigations into the impact of TEF on the prevalence of obesity, we see that higher TEF values are negatively associated with the prevalence of obesity. Since higher TEF reflects more consumed energy is used during digestion, resulting in each age-gender-BMI group having a lower energy surplus reducing future prevalence estimates for overweight and obesity. A change in prevalence estimates implies that the distribution of BMI differs for that age-gender group as TEF assumptions vary. Higher TEF leads to a distribution with lower overweight and obesity, translating in a distribution that is less skewed with greater mass around the mode.

Figure X shows an example of two distributions where there is a difference in the prevalence of obesity. Intervention in these two populations resulting in the same weight loss and reduction of BMI units corresponds to the shaded regions in the distributions. However, due to the different shapes of the distributions, the distribution with a higher prevalence of obesity results in larger reduction in obesity, reflected in a larger shaded region moving to the overweight BMI category. The estimated impact of an intervention is based on the population (and its distribution) it is being applied to; populations with higher obesity will have a greater estimated reduction compared to populations with lower obesity.

These results suggest that initial assumptions that impact future estimated BMI prevalence will have an impact on the reduction of obesity from intervention, irrespective of if the intervention acts on the same causal pathway as the initial assumption.

**Is this fair**
There may be additional relationships not considered in this investigation. 

+ Other possible distribution assumptions might reduce (or magnify) this relationship, i.e. additional degrees of freedom might allow distributions with more skewness or kurtosis, which might change this assessment. 

+ It is possible that an individual-level analysis of intervention data might show covariance between intervention effect and BMI. This would suggest that an individuals BMI impacts how successful an intervention is for them. Individuals with higher BMI may have a reduced or higher health benefit from intervention.


```{r, echo=F, warning=F, error=F, message=F, fig.width=1.3*1*5, fig.height=1*1*5}

y.10.parm=c(2.71184319173,0.27022059331)
y.20.parm=c(2.83471510373,0.246190222257)

ow.cp=18.09
ob.cp=20.9166666667

delta=1

dist.test<- data.frame(x=seq(5,35, 0.01)) %>% 
mutate(y.10=dlnorm(x, meanlog=y.10.parm[1], sdlog=y.10.parm[2])) %>% 
mutate(y.10.shading=ifelse(between(x, ob.cp, ob.cp+delta), y.10, 0)) %>% 
mutate(y.20=dlnorm(x,meanlog=y.20.parm[1], sdlog=y.20.parm[2])) %>% 
mutate(y.20.shading=ifelse(between(x, ob.cp, ob.cp+delta), y.20, 0))

dist.test%>% 
ggplot()+
geom_area(aes(x=x, y=y.20.shading, fill="Higher obesity"), alpha=0.3)+
geom_area(aes(x=x, y=y.10.shading, fill="Lower obesity"), alpha=0.3)+
geom_line(aes(x=x, y=y.20, color="Higher obesity"))+
geom_line(aes(x=x, y=y.10, color="Lower obesity"))+
geom_segment(aes(x = ob.cp, y =0, xend = ob.cp, yend = dlnorm(ob.cp,meanlog=y.20.parm[1], sdlog=y.20.parm[2])), color="grey40", linetype="dashed")+
# geom_segment(aes(x = ow.cp, y =0, xend = ow.cp, yend = dlnorm(ow.cp,meanlog=y.20.parm[1], sdlog=y.20.parm[2])), color="grey40",linetype="dashed")+
# ggtitle("Example distributions")+
ylab("Density")+xlab("BMI")+
theme_bw()+
guides(colour = guide_legend("Distribution", ncol = 2, title.position = "top"),
       fill = guide_legend("Population to migrate", ncol = 2, title.position = "top"))+
theme(legend.position = "bottom")


# y.10 case
# plnorm(ob.cp-delta, meanlog=y.10.parm[1], sdlog=y.10.parm[2])-plnorm(ob.cp, meanlog=y.10.parm[1], sdlog=y.10.parm[2])
# 
# (plnorm(ob.cp-delta, meanlog=y.10.parm[1], sdlog=y.10.parm[2])-plnorm(ob.cp, meanlog=y.10.parm[1], sdlog=y.10.parm[2]))/plnorm(ob.cp, meanlog=y.10.parm[1], sdlog=y.10.parm[2])
# 
# # y.20 case
# plnorm(ob.cp-delta, meanlog=y.20.parm[1], sdlog=y.20.parm[2])-plnorm(ob.cp, meanlog=y.20.parm[1], sdlog=y.20.parm[2])
# 
# (plnorm(ob.cp-delta, meanlog=y.20.parm[1], sdlog=y.20.parm[2])-plnorm(ob.cp, meanlog=y.20.parm[1], sdlog=y.20.parm[2]))/plnorm(ob.cp, meanlog=y.20.parm[1], sdlog=y.20.parm[2])
```

## Ranking of most sensitivity input 
### Early childhood prevention
```{r, echo=F, message=F, error=F, warning=F}
derivative_lsa_epoch_int %>% 
group_by(focus.title) %>%
summarise(mean=mean(abs.mean.ee.prop.alt)) %>% 
arrange(-mean) %>% 
mutate(focus.title1=case_when(grepl("Commonwealth Healthcare Costs",focus.title)~"Commonwealth Healthcare Costs",
                              grepl("Early Childhood Prevention Cost",focus.title)~"Early Childhood Prevention Cost",
                              grepl("Household Healthcare Costs",focus.title)~"Household Healthcare Costs ",
                              grepl("Productivity Loss of guardians from kids missing school",focus.title)~"Productivity Loss of guardians from kids missing school",
                              grepl("State Healthcare Costs",focus.title)~"State Healthcare Costs",
       grepl("Effect Non-core OR",focus.title)~"Effect Non-core OR")) %>% 
mutate(focus.title=ifelse(is.na(focus.title1), focus.title,focus.title1)) %>% 
select(focus.title, mean) %>% 
rename("Label"="focus.title", "Mean Elementary Effect"="mean") %>%
knitr::kable(.) %>% 
  kableExtra::footnote(., "Ranked variables")

```
### Childcare settings intervention
```{r, echo=F, message=F, error=F, warning=F}
derivative_lsa_cci_int %>% 
group_by(focus.title) %>%
summarise(mean=mean(abs.mean.ee.prop.alt)) %>% 
arrange(-mean) %>% 
mutate(focus.title1=case_when(grepl("Commonwealth Healthcare Costs",focus.title)~"Commonwealth Healthcare Costs",
                              grepl("Early Childhood Prevention Cost",focus.title)~"Early Childhood Prevention Cost",
                              grepl("Household Healthcare Costs",focus.title)~"Household Healthcare Costs ",
                              grepl("Productivity Loss of guardians from kids missing school",focus.title)~"Productivity Loss of guardians from kids missing school",
                              grepl("State Healthcare Costs",focus.title)~"State Healthcare Costs",
       grepl("Effect Non-core OR",focus.title)~"Effect Non-core OR")) %>% 
mutate(focus.title=ifelse(is.na(focus.title1), focus.title,focus.title1)) %>% 
select(focus.title, mean) %>% 
rename("Label"="focus.title", "Mean Elementary Effect"="mean") %>%
knitr::kable(.) %>% 
  kableExtra::footnote(., "Ranked variables")

```
### School-based settings intervention
```{r, echo=F, message=F, error=F, warning=F}
derivative_lsa_si_int %>% 
group_by(focus.title) %>%
summarise(mean=mean(abs.mean.ee.prop.alt)) %>% 
arrange(-mean) %>% 
mutate(focus.title1=case_when(grepl("Commonwealth Healthcare Costs",focus.title)~"Commonwealth Healthcare Costs",
                              grepl("Early Childhood Prevention Cost",focus.title)~"Early Childhood Prevention Cost",
                              grepl("Household Healthcare Costs",focus.title)~"Household Healthcare Costs ",
                              grepl("Productivity Loss of guardians from kids missing school",focus.title)~"Productivity Loss of guardians from kids missing school",
                              grepl("State Healthcare Costs",focus.title)~"State Healthcare Costs",
       grepl("Effect Non-core OR",focus.title)~"Effect Non-core OR")) %>% 
mutate(focus.title=ifelse(is.na(focus.title1), focus.title,focus.title1)) %>% 
select(focus.title, mean) %>% 
rename("Label"="focus.title", "Mean Elementary Effect"="mean") %>%
knitr::kable(.) %>% 
kableExtra::footnote(., "Ranked variables")

```

### Sports vouchers intervention
```{r, echo=F, message=F, error=F, warning=F}
derivative_lsa_svi_int %>% 
group_by(focus.title) %>%
summarise(mean=mean(abs.mean.ee.prop.alt)) %>% 
arrange(-mean) %>% 
mutate(focus.title1=case_when(grepl("Commonwealth Healthcare Costs",focus.title)~"Commonwealth Healthcare Costs",
                              grepl("Early Childhood Prevention Cost",focus.title)~"Early Childhood Prevention Cost",
                              grepl("Household Healthcare Costs",focus.title)~"Household Healthcare Costs ",
                              grepl("Productivity Loss of guardians from kids missing school",focus.title)~"Productivity Loss of guardians from kids missing school",
                              grepl("State Healthcare Costs",focus.title)~"State Healthcare Costs",
       grepl("Effect Non-core OR",focus.title)~"Effect Non-core OR")) %>% 
mutate(focus.title=ifelse(is.na(focus.title1), focus.title,focus.title1)) %>% 
select(focus.title, mean) %>% 
rename("Label"="focus.title", "Mean Elementary Effect"="mean") %>%
knitr::kable(.) %>% 
  kableExtra::footnote(., "Ranked variables")

```
### Sugar-sweetened beverage Tax
```{r, echo=F, message=F, error=F, warning=F}
derivative_lsa_ssb_int %>% 
group_by(focus.title) %>%
summarise(mean=mean(abs.mean.ee.prop.alt)) %>% 
arrange(-mean) %>% 
mutate(focus.title1=case_when(grepl("Commonwealth Healthcare Costs",focus.title)~"Commonwealth Healthcare Costs",
                              grepl("Early Childhood Prevention Cost",focus.title)~"Early Childhood Prevention Cost",
                              grepl("Household Healthcare Costs",focus.title)~"Household Healthcare Costs ",
                              grepl("Productivity Loss of guardians from kids missing school",focus.title)~"Productivity Loss of guardians from kids missing school",
                              grepl("State Healthcare Costs",focus.title)~"State Healthcare Costs",
       grepl("Effect Non-core OR",focus.title)~"Effect Non-core OR")) %>% 
mutate(focus.title=ifelse(is.na(focus.title1), focus.title,focus.title1)) %>% 
select(focus.title, mean) %>% 
rename("Label"="focus.title", "Mean Elementary Effect"="mean") %>%
knitr::kable(.) %>% 
  kableExtra::footnote(., "Ranked variables")

```
### Overall Ranking of base model sensitivity
```{r, echo=F, message=F, error=F, warning=F}
df_summary %>%
group_by(focus.title, scenario) %>%
summarise(mean_cum_sum_diff.der_value=mean(mean_cum_sum_diff.der_value)) %>%
arrange(-mean_cum_sum_diff.der_value) %>%
select(focus.title, scenario,  mean_cum_sum_diff.der_value) %>%
spread(., scenario, mean_cum_sum_diff.der_value) %>%
mutate(total=SSB+EPOCH+CCI+SI+SVI) %>%
arrange(-total) %>% select(-total) %>%
mutate(EPOCH=sprintf("%0.3f",mean(EPOCH)),
       CCI=sprintf("%0.3f",mean(CCI)),
       SI=sprintf("%0.3f",mean(SI)),
       SVI=sprintf("%0.3f",mean(SVI)),
       SSB=sprintf("%0.3f",mean(SSB))) %>%
rename("Label"="focus.title") %>% 
knitr::kable(.) %>%
kableExtra::add_header_above(c(" " = 1,"Average cummulative difference \n first derivative" = 5)) %>%
kableExtra::footnote(., "Ranked variables")
#   
```

# Early Prevention of Obesity in Children
## Early Prevention of Obesity in Children Scale up of intervention effects
```{r EPOCH Scale up der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
derivative_lsa_epoch_int %>% 
rename("Gender output"="gender.output") %>% 
filter(focus=="EPOCH Scale up factor") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender output`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("BMI Outcome"))+
ggtitle("Assumed Early Prevention of Obesity in Children Scale up factor")

```

## Early Prevention of Obesity in Children: RCT Intervention effect
```{r RCT Effects, echo=F, message=F, error=F, warning=F, fig.height=1*3*3.5, fig.width=1*2*3.5}
derivative_lsa_epoch_int %>% 
filter(focus=="Effect BF OR") %>% 
rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Assumed Intervention effect - breastfeeding")+

derivative_lsa_epoch_int %>% 
filter(focus=="Effect TV OR") %>% 
rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", " prevalence from intervention(" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Assumed Intervention effect - Screen time")+

derivative_lsa_epoch_int %>% 
filter(focus=="\"Effect Non-core OR\"") %>% 
  rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Assumed Intervention effect - Non-core food consumption")+

plot_layout(ncol = 1, nrow=3, guides = "collect")&
# plot_annotation(title = 'Intervention effect',
#                  theme = theme(plot.title = element_text(size = 16, hjust = 0.5,  face = c("bold")))) & 
theme(legend.position = "bottom")


```


## Percentage of infants exposed to intervention	
```{r Percentage of infants exposed der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
derivative_lsa_epoch_int %>% 
filter(focus=="Percentage of infants exposed") %>% 
  rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
# filter(gender.output=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
# geom_smooth(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output), se=F, linewidth=0.5)+
facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age group")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI Outcome"))+
ggtitle("Percentage of infants exposed to intervention")
```

```{r, echo=F, message=F, error=F, warning=F}
# lsa_int_epoch_df %>%
#   filter(year==2057) %>%
#   filter(focus=="Relapse Rate") %>% 
#   select(input.value, int.value)
```

## Early Prevention of Obesity in Children: Relapse Rate
```{r EPOCH Relapse Rate, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
derivative_lsa_epoch_int %>% 
filter(focus=="Relapse Rate EPOCH") %>% 
  rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age group")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom")+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
guides(colour = guide_legend("BMI"))+
ggtitle("Early Prevention of Obesity in Children Relapse Rate")
```

# Childcare setting intervention
## Childcare setting intervention Scale up factor
```{r Scale up der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
derivative_lsa_cci_int %>% 
filter(focus=="CCI Scale up factor") %>% 
  rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Assumed Childcare setting intervention Scale up factor")

```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*5*2.2}

p.tmp1<-derivative_lsa_cci_int %>% 
filter(focus=="CCI Scale up factor") %>% 
filter(gender.output=='Male') %>%
filter(age.groups.output!="Age 45 49") %>% 
  rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output), show.legend = F)+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
xlab("Age")+
ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in obesity from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
# guides(colour = guide_legend())+
ggtitle("Assumed CCI Scale up factor")

p.tmp2<-lsa_int_cci_df %>% 
filter(focus=="CCI Scale up factor") %>% 
filter(year==2057) %>% 
filter(gender.output=='Male') %>%
filter(age.groups.output!="Age 45 49") %>% 
  rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
# mutate(diff.int=int.value-det.int.value) %>% 
ggplot()+
geom_smooth(aes(x=input.value, y=diff, color=bmi.output), se=F, linewidth=0.5)+
facet_wrap(vars(age.groups.output), ncol = 4, nrow=3)+
guides(colour = guide_legend("BMI outcome"))+
scale_y_continuous(labels = scales::percent)+
ylab("Change in the prevalence (%)")+xlab("Assumed CCI Scale up factor")+
theme_bw() +theme(legend.position = "bottom")

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)+
# plot_annotation(title = 'Explaination of plots',
#                  theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
theme(legend.position = "bottom")

```

## Childcare settings intervention Change in Diet coefficients
```{r Childcare settings intervention Change in Diet der, echo=F, message=F, error=F, warning=F, fig.height=1*2*2, fig.width=1*5*2}
derivative_lsa_cci_int %>%
filter(grepl("Childcare settings intervention Change in Diet coefficients", focus)) %>% 
separate(focus, into=c("first","food.groups"),sep="\\[", remove = F) %>% 
mutate(`Food groups`=factor(case_when(food.groups=="Discretionary_foods]"~1,
                                     food.groups=="Fruit]"~2,
                                     food.groups=="NonAlcoholic_beverage]"~3,
                                     food.groups=="Sugar_Sweetened beverage]"~4,
                                     food.groups=="Vegetables]"~5),
                           levels=c(1,2,3,4,5),
                           labels=c("Discretionary foods","Fruit",
                                   "Other beverage","Sugar Sweetened beverage", "Vegetables"))) %>% 
  rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(rows=vars(`Gender outcome`),  cols=vars(`Food groups`), scale="free", labeller = label_both, independent = "x")+
# facet_grid(rows =vars(gender.output), cols=vars(food.groups), scale="free")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 6.5))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Childcare settings intervention Change in Diet")

```

## Childcare settings intervention Change in physical activity coefficients
```{r Childcare settings intervention Change in PA der, echo=F, message=F, error=F, warning=F, fig.height=1*2*2.5, fig.width=1.2*2*2.5}
derivative_lsa_cci_int %>%
filter(grepl("Childcare settings intervention Change in PA coefficients", focus)) %>% 
separate(focus, into=c("first","pa.groups"),sep="\\[", remove = F) %>% 
mutate(`PA Activity`=factor(case_when(pa.groups=="Light]"~1,
                                     pa.groups=="Screen]"~2),
                           levels=c(1,2),
                           labels=c("Light physical activity","Screen time"))) %>% 
rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(rows=vars(`Gender outcome`),  cols=vars(`PA Activity`), scale="free", labeller = label_both, independent = "x")+
# facet_grid(rows =vars(gender.output), cols=vars(pa.groups), scale="free")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Childcare settings intervention Change in physical activity")

```

## Percentage of childcare centers participating in intervention
```{r Percentage of childcare centers participating in intervention der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.2*2*4}

derivative_lsa_cci_int %>% 
filter(grepl("Percentage of childcare centers participating in intervention", focus)) %>% 
  rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
# facet_grid(col=vars(gender.output), scale="free")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Percentage of childcare centers participating in intervention")

```

## Definition in food groups
```{r, echo=F, message=F, error=F, warning=F, fig.height=1*2*4.2, fig.width=1*2*4.2}
derivative_lsa_cci_int %>% 
filter(grepl("Proportion of Cordial in SSB", focus)) %>% 
  rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Proportion of Cordial in SSB")+

derivative_lsa_cci_int %>% 
filter(grepl("Proportion of Packed snacks in Discretionary foods", focus)) %>% 
  rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Proportion of Packed snacks in Discretionary foods")+

# plot_layout(ncol=2, nrow=1, guides = "collect")&theme(legend.position = "bottom")

plot_layout(ncol = 1, nrow=2, guides = "collect")+
plot_annotation(title = 'Assumed composition of intervention foods',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")


```


# School-based settings interventions
## School-based interventions: Relapse Rate
```{r Relapse Rate SI der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
derivative_lsa_si_int %>% 
filter(grepl("Relapse Rate", focus)) %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Relapse rate")

```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*5*2.2}
p.tmp1<-derivative_lsa_si_int %>% 
filter(focus=="SI Scale up factor") %>% 
filter(gender.output=='Male') %>%
filter(age.groups.output!="Age 45 49") %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output), show.legend = F)+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
xlab("Age")+
ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in obesity from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
# guides(colour = guide_legend())+
ggtitle("Assumed SI Scale up factor")

p.tmp2<-lsa_int_si_df %>% 
filter(focus=="SI Scale up factor") %>% 
filter(year==2057) %>% 
filter(gender.output=='Male') %>%
filter(age.groups.output!="Age 45 49") %>% 
# mutate(diff.int=int.value-det.int.value) %>% 
ggplot()+
geom_smooth(aes(x=input.value, y=diff, color=bmi.output), se=F, linewidth=0.5)+
facet_wrap(vars(age.groups.output), ncol = 4, nrow=3)+
guides(colour = guide_legend("BMI outcome"))+
scale_y_continuous(labels = scales::percent)+
ylab("Change in the prevalence (%)")+xlab("Assumed SI Scale up factor")+
theme_bw() +theme(legend.position = "bottom")

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)+
# plot_annotation(title = 'Explaination of plots',
#                  theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
theme(legend.position = "bottom")

```

## Percentage of Schools participating in intervention
```{r SI Percentage of Schools participating in intervention der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
derivative_lsa_si_int %>% 
filter(grepl("SI Percentage of Schools participating in intervention", focus)) %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Percentage of Schools participating in intervention")

```

## Percentage of total diet consumed at school
```{r SI percentage of total diet consumed at school der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
derivative_lsa_si_int %>% 
filter(grepl("SI percentage of total diet consumed at school", focus)) %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Percentage of total diet consumed at school")

```

## School-based intervention Scale up factor
```{r SI Scale up factor der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
derivative_lsa_si_int %>% 
filter(grepl("SI Scale up factor", focus)) %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("School based interventions - Scale up factor")

```

## Phyisical activity at school 
```{r SI change in PA der, echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1.6*1*4}
derivative_lsa_si_int %>% 
filter(grepl("SI % change in PA", focus)) %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Increase in physical activity")

```

## Reduction In student canteen purchases
```{r SI Reduction In student Purchases der, echo=F, message=F, error=F, warning=F, fig.height=1*11*2, fig.width=1.6*2*2}
derivative_lsa_si_int %>% 
filter(grepl("SI % Reduction In student Purchases", focus)) %>% 
separate(focus, into=c("first","food.groups"),sep="\\[", remove = F) %>% 
mutate(`Food groups`=factor(case_when(food.groups=="Dairy]"~1,
                                    food.groups=="Discretionary_foods]"~2,
                                    food.groups=="Fats]"~3,
                                    food.groups=="Fruit]"~4,
                                    food.groups=="Grains]"~5,
                                    food.groups=="Meat]"~6,
                                    food.groups=="NonAlcoholic_beverage]"~7,
                                    food.groups=="Other]"~8,
                                    food.groups=="Sugar_Sweetened beverage]"~9,
                                    food.groups=="Vegetables]"~10,
                                    food.groups=="Water]"~11),
                           levels=c(seq(1:11)),
                           labels=c("Dairy","Discretionary foods","Fats","Fruit","Grains","Meat",
                                   "Other beverage","Other","Sugar Sweetened beverage", "Vegetables", "Water"))) %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),rows=vars(`Food groups`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Reduction In student canteen purchases")

```

## Percentage of children attending School 
```{r SI Percentage of children attending School der, echo=F, message=F, error=F, warning=F, fig.height=1*5*2.5, fig.width=1.4*2*2.5}
derivative_lsa_si_int %>% 
filter(grepl("SI Percentage of children attending School", focus)) %>% 
separate(focus, into=c("first","age.groups.intput"),sep="\\[", remove = F) %>% 
mutate( `Age input`=factor(case_when(grepl("Age_2,",age.groups.intput)~1,
                                            grepl("Age_3_5",age.groups.intput)~2,
                                            grepl("Age_6_8",age.groups.intput)~3,
                                            grepl("Age_9_11" ,age.groups.intput)~4,
                                            grepl("Age_12_14",age.groups.intput)~5,
                                            grepl("Age_15_17",age.groups.intput)~6,
                                            grepl("Age_18_19",age.groups.intput)~7,
                                            grepl("Age_20_24",age.groups.intput)~8,
                                            grepl("Age_25_29",age.groups.intput)~9,
                                            grepl("Age_30_34",age.groups.intput)~10,
                                            grepl("Age_35_39",age.groups.intput)~11,
                                            grepl("Age_40_44",age.groups.intput)~12,
                                            grepl("Age_45_49",age.groups.intput)~13),
                                  levels=c(seq(1:13)), 
                                  labels=c("Age 2","Age 3 5","Age 6 8","Age 9 11","Age 12 14","Age 15 17",
                                           "Age 18 19","Age 20 24" ,"Age 25 29","Age 30 34","Age 35 39",
                                           "Age 40 44","Age 45 49"))) %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),rows=vars(`Age input`),  scale="free", labeller = label_both, independent = "x")+
# facet_grid(cols =vars(gender.output), rows=vars(age.groups.input), scale="free")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Percentage of children attending School")

```

# Sports voucher interventions
## Sports vouchers Scale up factor
```{r SVI Scale up factor der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
derivative_lsa_svi_int %>% 
filter(grepl("SVI Scale up factor", focus)) %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("SVI Scale up factor")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*5*2.2}
p.tmp1<-derivative_lsa_svi_int %>% 
filter(grepl("SVI Scale up factor", focus)) %>% 
filter(gender.output=='Male') %>%
filter(age.groups.output!="Age 45 49") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output), show.legend = F)+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
xlab("Age")+
ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in obesity from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
# guides(colour = guide_legend())+
ggtitle("Assumed SVI Scale up factor")

p.tmp2<-lsa_int_svi_df %>% 
filter(grepl("SVI Scale up factor", focus)) %>% 
filter(year==2057) %>% 
filter(gender.output=='Male') %>%
filter(age.groups.output!="Age 45 49") %>% 
# mutate(diff.int=int.value-det.int.value) %>% 
ggplot()+
geom_smooth(aes(x=input.value, y=diff, color=bmi.output), se=F, linewidth=0.5)+
facet_wrap(vars(age.groups.output), ncol = 4, nrow=3)+
guides(colour = guide_legend("BMI outcome"))+
scale_y_continuous(labels = scales::percent)+
ylab("Change in the prevalence (%)")+xlab("Assumed SVI Scale up factor")+
theme_bw() +theme(legend.position = "bottom")

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)+
# plot_annotation(title = 'Explaination of plots',
#                  theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
theme(legend.position = "bottom")

```

## Percentage of the population that Registers for vouchers
```{r percentage of population that Registers for vouchers der, echo=F, message=F, error=F, warning=F, fig.height=1*5*2.2, fig.width=1.5*2*2.2} 
derivative_lsa_svi_int %>% 
filter(grepl("% of population that Registers for vouchers", focus)) %>% 
separate(focus, into=c("first","age.groups.intput"),sep="\\[", remove = F) %>% 
mutate( `Age input`=factor(case_when(grepl("Age_2,",age.groups.intput)~1,
                                            grepl("Age_3_5",age.groups.intput)~2,
                                            grepl("Age_6_8",age.groups.intput)~3,
                                            grepl("Age_9_11" ,age.groups.intput)~4,
                                            grepl("Age_12_14",age.groups.intput)~5,
                                            grepl("Age_15_17",age.groups.intput)~6,
                                            grepl("Age_18_19",age.groups.intput)~7,
                                            grepl("Age_20_24",age.groups.intput)~8,
                                            grepl("Age_25_29",age.groups.intput)~9,
                                            grepl("Age_30_34",age.groups.intput)~10,
                                            grepl("Age_35_39",age.groups.intput)~11,
                                            grepl("Age_40_44",age.groups.intput)~12,
                                            grepl("Age_45_49",age.groups.intput)~13),
                                  levels=c(seq(1:13)), 
                                  labels=c("Age 2","Age 3 5","Age 6 8","Age 9 11","Age 12 14","Age 15 17",
                                           "Age 18 19","Age 20 24" ,"Age 25 29","Age 30 34","Age 35 39",
                                           "Age 40 44","Age 45 49"))) %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),rows=vars(`Age input`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("% of population that Registers for vouchers")

```

## Average Number of Hours of organised sports or activities Weekly
```{r Average Number of Hours of organised sports or activities Weekly der, echo=F, message=F, error=F, warning=F, fig.height=1*5*2, fig.width=1.2*6*2}
derivative_lsa_svi_int %>% 
filter(grepl("Average Number of Hours of organised sports or activities Weekly", focus)) %>% 
separate(focus, into=c("first","age.groups.input"),sep="\\[", remove = F) %>% 
mutate(bmi.input=factor(case_when(grepl("Underweight & Healthy weight", age.groups.input)~1,
                                  grepl("Overweight", age.groups.input)~2,
                                  grepl("Obese", age.groups.input)~3),
                        levels=c(1,2,3),labels=c("Underweight & Healthy weight", "Overweight", "With obesity"))) %>% 
mutate(`Age input`=factor(case_when(grepl("Age_2,",age.groups.input)~1,
                                            grepl("Age_3_5",age.groups.input)~2,
                                            grepl("Age_6_8",age.groups.input)~3,
                                            grepl("Age_9_11" ,age.groups.input)~4,
                                            grepl("Age_12_14",age.groups.input)~5,
                                            grepl("Age_15_17",age.groups.input)~6,
                                            grepl("Age_18_19",age.groups.input)~7,
                                            grepl("Age_20_24",age.groups.input)~8,
                                            grepl("Age_25_29",age.groups.input)~9,
                                            grepl("Age_30_34",age.groups.input)~10,
                                            grepl("Age_35_39",age.groups.input)~11,
                                            grepl("Age_40_44",age.groups.input)~12,
                                            grepl("Age_45_49",age.groups.input)~13),
                                  levels=c(seq(1:13)), 
                                  labels=c("Age 2","Age 3 5","Age 6 8","Age 9 11","Age 12 14","Age 15 17",
                                           "Age 18 19","Age 20 24" ,"Age 25 29","Age 30 34","Age 35 39",
                                           "Age 40 44","Age 45 49"))) %>% 
    rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`, `BMI input`),rows=vars(`Age input`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=12),
                 strip.text = element_text(size = 8))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Average Number of Hours of organised sports or activities Weekly")

```

## Average proportion attributed to vouchers
```{r Average proportion attributed to vouchers der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
derivative_lsa_svi_int %>% 
filter(grepl("Average proportion attributed to vouchers", focus)) %>% 
      rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y= element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Average proportion attributed to vouchers", subtitle = "Per 0.01")
```

## Average Metabolic Equivalent of Task (MET) for sports Inputs  
```{r Average MET Calculated Inputs der,echo=F, message=F, error=F, warning=F, fig.height=1*2*4, fig.width=1*2*4}
derivative_lsa_svi_int %>% 
filter(grepl("Females Average MET Calculated Inputs", focus)) %>% 
      rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Females sports Average MET Calculated Inputs")+

derivative_lsa_svi_int %>% 
filter(grepl("Males Average MET Calculated Inputs", focus)) %>% 
      rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Male Average sports MET Calculated Inputs")+

plot_layout(ncol=1, nrow = 2, guides = "collect")&theme(legend.position ="bottom")
```

## Sports voucher interventions: Relapse Rate
```{r Relapse Rate SVI der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
derivative_lsa_svi_int %>% 
filter(grepl("Relapse Rate", focus)) %>% 
      rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Relapse Rate")
```


# Sugar-Sweetened Beverge Tax %
## Sugar-Sweetened Beverge Scale up factor
```{r SSB Scale up factor der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
derivative_lsa_ssb_int %>% 
filter(grepl("SSB Scale up factor", focus)) %>% 
      rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Scale up factor")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*5*2.2}

p.tmp1<-derivative_lsa_ssb_int %>% 
filter(grepl("SSB Scale up factor", focus)) %>% 
filter(gender.output=='Male') %>%
filter(age.groups.output!="Age 45 49") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output), show.legend = F)+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
xlab("Age")+
ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in obesity from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
# guides(colour = guide_legend())+
ggtitle("Assumed SVI Scale up factor")

p.tmp2<-lsa_int_ssb_df %>% 
filter(grepl("SSB Scale up factor", focus)) %>% 
filter(year==2057) %>% 
filter(gender.output=='Male') %>%
filter(age.groups.output!="Age 45 49") %>% 
# mutate(diff.int=int.value-det.int.value) %>% 
ggplot()+
geom_smooth(aes(x=input.value, y=diff, color=bmi.output), se=F, linewidth=0.5)+
facet_wrap(vars(age.groups.output), ncol = 4, nrow=3)+
guides(colour = guide_legend("BMI outcome"))+
scale_y_continuous(labels = scales::percent)+
ylab("Change in the prevalence (%)")+xlab("Assumed SVI Scale up factor")+
theme_bw() +theme(legend.position = "bottom")

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)+
# plot_annotation(title = 'Explaination of plots',
#                  theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
theme(legend.position = "bottom")

```


## Price Elasticity - Cordial
```{r PE Cordial der,echo=F, message=F, error=F, warning=F, fig.height=1*7*2, fig.width=1.5*2*2}
derivative_lsa_ssb_int %>% 
filter(grepl("PE Cordial", focus)) %>% 
      rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
# select(focus) %>% table()
separate(focus, into=c("first","drink.groups"),sep="\\[", remove = F) %>% 
mutate(`Drinks`=factor(case_when(drink.groups=="Regular Soft_Drinks]"~1,
                                    drink.groups=="Fruit Drink]"~2,
                                    drink.groups=="Fruit Juice]"~3,
                                    drink.groups=="Low Fat Milk]"~4,
                                    drink.groups=="Cordial]"~5,
                                    drink.groups=="Tea]"~6,
                                    drink.groups=="Water]"~7,
                                    drink.groups=="Diet Soft Drinks]"~8,
                                    drink.groups=="Coffee]"~9),
                           levels=c(seq(1:9)),
                           labels=c("Regular Soft Drinks","Fruit Drink","Fruit Juice",
                                    "Low Fat Milk","Cordial","Tea","Water", "Diet Soft Drinks","Coffee"))) %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`), rows = vars(`Drinks`) ,scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Price elasticitiy for cordial")
```


## Price Elasticity -  Fruit Drink
```{r PE Fruit Drink der,echo=F, message=F, error=F, warning=F , fig.height=1*6*2.5, fig.width=1.5*2*2.5}
derivative_lsa_ssb_int %>% 
filter(grepl("PE Fruit Drink", focus)) %>% 
      rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
# select(focus) %>% table()
separate(focus, into=c("first","drink.groups"),sep="\\[", remove = F) %>% 
mutate(`Drinks`=factor(case_when(drink.groups=="Regular Soft_Drinks]"~1,
                                    drink.groups=="Fruit Drink]"~2,
                                    drink.groups=="Fruit Juice]"~3,
                                    drink.groups=="Low Fat Milk]"~4,
                                    drink.groups=="Cordial]"~5,
                                    drink.groups=="Tea]"~6,
                                    drink.groups=="Water]"~7,
                                    drink.groups=="Diet Soft Drinks]"~8,
                                    drink.groups=="Coffee]"~9),
                           levels=c(seq(1:9)),
                           labels=c("Regular Soft Drinks","Fruit Drink","Fruit Juice",
                                    "Low Fat Milk","Cordial","Tea","Water", "Diet Soft Drinks","Coffee"))) %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`), rows = vars(`Drinks`) ,scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Price elasticitiy for fruit drink")
```

## Price Elasticity -  Soft drink
```{r PE Soft drink der,echo=F, message=F, error=F, warning=F, fig.height=1*3*2.5, fig.width=1.5*2*2.5}
derivative_lsa_ssb_int %>% 
filter(grepl("PE Soft drink", focus)) %>% 
      rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
# select(focus) %>% table()
separate(focus, into=c("first","drink.groups"),sep="\\[", remove = F) %>% 
mutate(`Drinks`=factor(case_when(drink.groups=="Regular Soft_Drinks]"~1,
                                    drink.groups=="Fruit Drink]"~2,
                                    drink.groups=="Fruit Juice]"~3,
                                    drink.groups=="Low Fat Milk]"~4,
                                    drink.groups=="Cordial]"~5,
                                    drink.groups=="Tea]"~6,
                                    drink.groups=="Water]"~7,
                                    drink.groups=="Diet Soft Drinks]"~8,
                                    drink.groups=="Coffee]"~9),
                           levels=c(seq(1:9)),
                           labels=c("Regular Soft Drinks","Fruit Drink","Fruit Juice",
                                    "Low Fat Milk","Cordial","Tea","Water", "Diet Soft Drinks","Coffee"))) %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`), rows = vars(`Drinks`) ,scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Price elasticitiy for fruit drink")
```

## Sugar-Sweetened Beverge Tax: Relapse Rate
```{r Relapse Rate SSB der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
derivative_lsa_ssb_int %>% 
filter(grepl("Relapse Rate", focus)) %>% 
      rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Sugar-Sweetened Beverge Relapse Rate")
```

## Sugar-Sweetened Beverge Tax %
```{r SB Tax percent der,echo=F, message=F, error=F, warning=F, fig.height=1*1*4, fig.width=1*2*4}
derivative_lsa_ssb_int %>% 
filter(grepl("SSB Tax", focus)) %>% 
      rename("Gender outcome"="gender.output",
       "BMI input"="bmi.input",
       "Age input"="age.groups.input") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=bmi.output), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=bmi.output))+
facet_grid2(col=vars(`Gender outcome`),  scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
 xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y = element_text(size=8),
                 strip.text = element_text(size = 7))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1))+
guides(colour = guide_legend("BMI outcome"))+
ggtitle("Sugar-Sweetened Beverge Tax %")
```

# Interaction between intervention assumptions and base model assumptions

## Body Weight 
**Change in male body weight input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>% 
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Males")+

derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male body weight (kg)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Females")+

derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Females with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male body weight (kg)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

**Change in female body weight input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Males")+

derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Female body weight (kg)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Females")+

derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Females with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Female body weight (kg)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```


**Explanation of summary results**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*4.5*2.2}
p.tmp1<-derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
filter(`BMI input`=="Overweight" & `Age input`=="Age 3 5") %>% 
  filter(age.groups.output!="Age 45 49") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario), show.legend = F)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age")+
ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 plot.title = element_text(face = c("bold")),
                 plot.subtitle = element_text(),
                 strip.text = element_text(size = 7),
                 axis.title.y = element_text(size=7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
 ggtitle("Summary plot - Mean Elementary Effect by age",subtitle="Male outcomes")

p.tmp2<-plot.df %>% 
rename("Gender input"="gender.input", "BMI outcome"="BMI output", "BMI input"="bmi.input", "Age input"="age.groups.input") %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>% 
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
filter(`BMI input`=="Overweight" ) %>% 
filter(`Age input`=="Age 3 5") %>%
filter(`Age output`!="Age 45 49") %>% 
mutate(prop=((input.value/initial.input)-1)*100) %>% 
ggplot()+
  geom_smooth(aes(x=prop, y=diff, color=scenario), se=F, linewidth=0.5)+
 facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  facet_wrap(vars(`Age output`), scales="free", ncol = 4, nrow=3)+
guides(colour = guide_legend("Scenario"),
       linetype = guide_legend("Scenario"),
       alpha = guide_legend("Scenario"))+
scale_y_continuous(labels = scales::percent)+
scale_x_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1), limits = c(-20, 20),
                   sec.axis = sec_axis(~(.+100)*20.7/100, name = "Body weight (Kg)", labels = scales::label_number(suffix = "kg")))+
ggtitle("Individual relationships", subtitle = "Prevalence of obesity vs assumed Body Weight (kg) for overweight males aged 3 to 5")+
ylab("Change in the prevalence of overweight (%)")+xlab("Percentage change in Body Weight (kg) for overweight males aged 3 to 5")+
    theme_bw() +theme(legend.position = "bottom",
                    panel.spacing.y =unit(0, "mm"),
                    panel.spacing.x =unit(4, "mm"),
                    plot.title = element_text(face = c("bold")),
                    plot.subtitle = element_text())

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)&
# plot_annotation(title = 'Break down of summary results',
#                  theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
theme(legend.position = "bottom")

```


## Height
**Change in male height input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="\"Reference height (m)\"" ) %>% 
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Males")+

derivative.lsa.combined %>%
filter(focus.title=="\"Reference height (m)\"" ) %>% 
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male height (m)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="\"Reference height (m)\"" ) %>% 
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Females")+

derivative.lsa.combined %>%
filter(focus.title=="\"Reference height (m)\"" ) %>% 
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Females with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male height (m)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

**Change in female height input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="\"Reference height (m)\"" ) %>% 
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Males")+

derivative.lsa.combined %>%
filter(focus.title=="\"Reference height (m)\"" ) %>% 
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Female height (m)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="\"Reference height (m)\"" ) %>% 
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Females")+

derivative.lsa.combined %>%
filter(focus.title=="\"Reference height (m)\"" ) %>% 
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height  (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Females with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Female height (m)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

## Growth Function kJ/day
**Male growth assumptions**
```{r , echo=F, message=F, error=F, warning=F, fig.width=1.6*5*1.2,fig.height=1*8*1.2}
derivative.lsa.combined %>%
  filter(focus.title=="\"Growth Function kJ/day\"") %>% 
 mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                     grepl(", F]", focus)~2),
                           levels=c(1,2),
                           labels=c("Male","Female"))) %>% 
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males")+

derivative.lsa.combined %>%
  filter(focus.title=="\"Growth Function kJ/day\"") %>% 
 mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                     grepl(", F]", focus)~2),
                           levels=c(1,2),
                           labels=c("Male","Female"))) %>% 
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                                   axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Female")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male Growth Function (kJ/day)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

**Female growth assumptions**
```{r , echo=F, message=F, error=F, warning=F, fig.width=1.6*5*1.2,fig.height=1*8*1.2}
derivative.lsa.combined %>%
  filter(focus.title=="\"Growth Function kJ/day\"") %>% 
 mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                     grepl(", F]", focus)~2),
                           levels=c(1,2),
                           labels=c("Male","Female"))) %>% 
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males")+

derivative.lsa.combined %>%
  filter(focus.title=="\"Growth Function kJ/day\"") %>% 
 mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                     grepl(", F]", focus)~2),
                           levels=c(1,2),
                           labels=c("Male","Female"))) %>% 
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                                   axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Female")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Female Growth Function (kJ/day)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

## Macronutrient energy density 
```{r, echo=F, message=F, error=F, warning=F, fig.width=1.6*4*2,fig.height=1.1*6*2}

left.margin=50

p.tmp1<-derivative.lsa.combined %>%
filter(focus.title=="\"NON-SUGAR CARBOHYDRATES Kj per gram\"" ) %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 # axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8),
                 # unit(c(top, right, bottom, left), units)
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Carbohydrates")

p.tmp2<-derivative.lsa.combined %>%
filter(focus.title=="FATS Kj per gram" ) %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 # axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8),
                 # unit(c(top, right, bottom, left), units)
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Dietary fats")

p.tmp3<-derivative.lsa.combined %>%
filter(focus.title=="PROTEIN Kj per gram" ) %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 # axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8),
                 # unit(c(top, right, bottom, left), units)
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Protein")

p.tmp4<-derivative.lsa.combined %>%
filter(focus.title=="SUGAR Kj per gram" ) %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 # axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8),
                 # unit(c(top, right, bottom, left), units)
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Sugars")

tmp.y.lab<-p.tmp1$labels$y
p.tmp1$labels$y<-"";p.tmp2$labels$y<-"";p.tmp3$labels$y<-"";p.tmp4$labels$y<-""

p.tmp1+p.tmp2+p.tmp3+p.tmp4+
plot_layout(nrow = 4, ncol=1, guides = "collect")+
plot_annotation(title = 'Energy density (kJ/gram)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom"); grid::grid.draw(grid::textGrob(tmp.y.lab, x = 0.03, rot = 90))

```


**Explanation of summary results**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.5,fig.height=1*5*2.5}
p.tmp1<-derivative.lsa.combined %>%
  filter(focus.title=="PROTEIN Kj per gram" ) %>%
# filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
# filter(`BMI input`=="Overweight") %>% 
  filter(age.groups.output!="Age 45 49") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario), show.legend = F)+
# facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age")+
ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 plot.title = element_text(face = c("bold")),
                 plot.subtitle = element_text(),
                 strip.text = element_text(size = 7),
                 # axis.title.y = element_text(size=7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
 ggtitle("Summary plot - Mean Elementary Effect by age",subtitle="Male outcomes")

p.tmp2<-plot.df %>% 
 rename("Gender input"="gender.input", "BMI outcome"="BMI output", "BMI input"="bmi.input", "Age input"="age.groups.input") %>%
filter(focus.title=="PROTEIN Kj per gram" ) %>%
# filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
# filter(`BMI input`=="Overweight") %>%
filter(`Age output`!="Age 45 49") %>% 
mutate(prop=((input.value/initial.input)-1)*100)%>% 
ggplot()+
  geom_smooth(aes(x=prop, y=diff, color=scenario), se=F, linewidth=0.5)+
 facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  facet_wrap(vars(`Age output`), scales="free", ncol = 4, nrow=3)+
guides(colour = guide_legend("Scenario"),
       linetype = guide_legend("Scenario"),
       alpha = guide_legend("Scenario"))+
scale_y_continuous(labels = scales::percent)+
scale_x_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1), limits = c(-20, 20),
                   sec.axis = sec_axis(~(.+100)*13.7775/100, name = "kJ/g", labels = scales::label_number(suffix = "")))+
ggtitle("Individual relationships", subtitle = "Prevalence of obesity vs assumed Protein kJ/g")+
ylab("Change in the prevalence of obesity (%)")+xlab("Percentage change in assumed Protein kJ/g")+
    theme_bw() +theme(legend.position = "bottom",
                    panel.spacing.y =unit(0, "mm"),
                    panel.spacing.x =unit(4, "mm"),
                    plot.title = element_text(face = c("bold")),
                    plot.subtitle = element_text())

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)&
# plot_annotation(title = 'Break down of summary results',
#                  theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
theme(legend.position = "bottom")

```



## Thermic effect of food (TEF)
```{r, echo=F, message=F, error=F, warning=F, fig.width=1.6*4*2,fig.height=1.1*6*2}

left.margin=50

p.tmp1<-derivative.lsa.combined %>%
filter(focus.title=="CARBOHYDRATE TEF" ) %>% 
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 # axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8),
                 # unit(c(top, right, bottom, left), units)
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Carbohydrates")

p.tmp2<-derivative.lsa.combined %>%
filter(focus.title=="FATS TEF" ) %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 # axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8),
                 # unit(c(top, right, bottom, left), units)
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Dietary fats")

p.tmp3<-derivative.lsa.combined %>%
filter(focus.title=="PROTEIN TEF" ) %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 # axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8),
                 # unit(c(top, right, bottom, left), units)
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Protein")



p.tmp4<-derivative.lsa.combined %>%
filter(focus.title=="SUGAR TEF" ) %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 # axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8),
                 # unit(c(top, right, bottom, left), units)
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Sugars")

tmp.y.lab<-p.tmp1$labels$y
p.tmp1$labels$y<-"";p.tmp2$labels$y<-"";p.tmp3$labels$y<-"";p.tmp4$labels$y<-""

p.tmp1+p.tmp2+p.tmp3+p.tmp4+
plot_layout(nrow = 4, ncol=1, guides = "collect")+
plot_annotation(title = 'Thermic effect of food (TEF)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom"); grid::grid.draw(grid::textGrob(tmp.y.lab, x = 0.03, rot = 90))

```

**Explanation of summary results**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.2*4*2.5,fig.height=1*5*2.5}
# list.of.focus.variables.levels.plot.search %>% 
# filter(focus.title=="CARBOHYDRATE TEF" )
p.tmp1<-derivative.lsa.combined %>%
filter(focus.title=="CARBOHYDRATE TEF" ) %>% 
# filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
# filter(`BMI input`=="Overweight") %>% 
  filter(age.groups.output!="Age 45 49") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario), show.legend = F)+
# facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age")+
ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 plot.title = element_text(face = c("bold")),
                 plot.subtitle = element_text(),
                 strip.text = element_text(size = 7),
                 # axis.title.y = element_text(size=7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
 ggtitle("Summary plot - Mean Elementary Effect by age",subtitle="Male outcomes")

p.tmp2<-plot.df %>% 
 rename("Gender input"="gender.input", "BMI outcome"="BMI output", "BMI input"="bmi.input", "Age input"="age.groups.input") %>%
filter(focus.title=="CARBOHYDRATE TEF" ) %>% 
# filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
# filter(`BMI input`=="Overweight") %>%
filter(`Age output`!="Age 45 49") %>% 
mutate(prop=((input.value/initial.input)-1)*100)%>% 
ggplot()+
  geom_smooth(aes(x=prop, y=diff, color=scenario), se=F, linewidth=0.5)+
 facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  facet_wrap(vars(`Age output`), scales="free", ncol = 4, nrow=3)+
guides(colour = guide_legend("Scenario"),
       linetype = guide_legend("Scenario"),
       alpha = guide_legend("Scenario"))+
scale_y_continuous(labels = scales::percent)+
scale_x_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1), limits = c(-20, 20),
                   sec.axis = sec_axis(~(.+100)*0.1238/100, name = "TEF", labels = scales::label_number(suffix = "")))+
ggtitle("Individual relationships", subtitle = "Prevalence of obesity vs assumed Carbohydrate (TEF)")+
ylab("Change in the prevalence of obesity (%)")+xlab("Percentage change in assumed Carbohydrate (TEF)")+
    theme_bw() +theme(legend.position = "bottom",
                    panel.spacing.y =unit(0, "mm"),
                    panel.spacing.x =unit(4, "mm"),
                    plot.title = element_text(face = c("bold")),
                    plot.subtitle = element_text())

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)&
# plot_annotation(title = 'Break down of summary results',
#                  theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
theme(legend.position = "bottom")

```


## Adult to Adult Social Transmission
```{r Adult to Adult Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1.6*2*2.5,fig.height=1*4*2.5}
# Confirm units
# lsa_bmi_df %>%
#     filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
#   select(input.value, `2057`)
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Adult to Adult Social Transmission of dietary Behaviors")+

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title=="Adult to Adult Social Transmission of PAL Behaviors" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Adult to Adult Social Transmission of physical Behaviors")+

plot_layout(nrow = 2, guides = "collect") +
plot_annotation(title = 'Adult to Adult Role Modelling',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")

```


## Adult to Child Social Transmission
```{r Adult to Child Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1.6*2*3,fig.height=1*4*3}
# Confirm units
# lsa_bmi_df %>%
#     filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
#   select(input.value, `2057`)
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title=="Adult to Child Social Transmission DIET Behaviors" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Adult to Child Social Transmission of dietary Behaviors")+

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title=="Adult to Child Social Transmission PAL Behaviors" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Adult to Child Social Transmission of physical Behaviors")+

plot_layout(nrow = 2, guides = "collect") +
plot_annotation(title = 'Adult to Child Role Modelling',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")

```


## Child to Child Social Transmission
```{r Child to Child Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1.6*2*3,fig.height=1*4*3}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title=="Child to Child Social Transmission of DIET Behavior" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Child to Child Social Transmission of dietary Behaviors")+

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title=="Child to Child Social Transmission of PAL Behaviors" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("BMI outcomes"))+
ggtitle("Child to Child Social Transmission of physical Behaviors")+

plot_layout(nrow = 2, guides = "collect") +
plot_annotation(title = 'Child to Child Role Modelling',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")

```

## Infant Reported behaviours
```{r Infant Reported behaviours, echo=F, message=F, error=F, warning=F, fig.width=1.6*2*2.5,fig.height=1*6*2.5}

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title=="\"Percentage BF >6mths reported\"" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Percentage of mothers breastfeeding to 6 months")+

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="\"Percentage non-core > 0 reported\"" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Percentage of infants consuming non-core foods")+

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="\"Percentage TV >1 per day reported\"" ) %>%
  ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Percentage of infants watching TV more than 1 hr/day")+

plot_layout(nrow = 3, ncol=1, guides = "collect") +
plot_annotation(title = 'Infant behaviours',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")


```

## Assumed intergenerational relationships
```{r Intergenerational OR effects, echo=F, message=F, error=F, warning=F, fig.width=1.6*2*2.5,fig.height=1*10*2.5}

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title=="Intercept" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Intercept")+

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="Parents BMI" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Impact of parents BMI on infants weight")+

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="Breastfeeding >=6mth" ) %>%
  ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Impact of breastfeeding on infants weight")+

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="TV >=1" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Impact of TV on infants weight")+

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="Non-core >0" ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Impact of non-core foods on infants weight")+

plot_layout(nrow = 5, ncol=1, guides = "collect") +
plot_annotation(title = 'Logistic regression odds ratio',subtitle = "Odds of overweight or obesity at 2 years",
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) & 
theme(legend.position = "bottom")


```

## Mortality ratios
```{r Mortality ratios, echo=F, message=F, error=F, warning=F, fig.width=1.6*3*2, fig.height=1*4*2}
derivative.lsa.combined %>%
filter(focus.title=="BMI Hazards Ratios" ) %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`BMI input`), rows = vars(`BMI outcome`,`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 unit (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Hazards Ratios")+
  plot_annotation(title = 'Mortality',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")


```

## The Metabolic Equivalent of Task (MET)
```{r METs, echo=F, message=F, error=F, warning=F, warning=F, fig.width=1.6*4*2, fig.height=1.6*6*2}

left.margin=50

p.tmp1<-derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="INACTIVE METs") %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("METs - Inactivity")

p.tmp2<-derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="SCREEN TIME METs") %>%
  ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("METs - Screen time")

p.tmp3<-derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="SLEEP METs") %>%
  ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("METs - Sleep")

p.tmp4<-derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="LIGHT PA METs") %>%
 ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("METs - Light physical activity")

p.tmp5<-derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="MODERATE PA METs") %>%
 ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("METs - Moderate physical activity")

p.tmp6<-derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
filter(focus.title=="VIGOROUS PA METs") %>%
 ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 # strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("METs - Vigorous physical activity")




tmp.y.lab<-p.tmp1$labels$y
p.tmp1$labels$y<-"";p.tmp2$labels$y<-"";p.tmp3$labels$y<-"";p.tmp4$labels$y<-"";p.tmp5$labels$y<-"";p.tmp6$labels$y<-""

p.tmp1+p.tmp2+p.tmp3+p.tmp4+p.tmp5+p.tmp6+
plot_layout(ncol=1, nrow = 6, guides = "collect") +
plot_annotation(title = 'Metabolic Equivelence of Task (MET)',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) & 
theme(legend.position = "bottom"); grid::grid.draw(grid::textGrob(tmp.y.lab, x = 0.03, rot = 90))


```

**Explanation of summary results**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.2*4*2.5,fig.height=1*5*2.5}
# list.of.focus.variables.levels.plot.search %>%
#   filter(focus.title=="LIGHT PA METs") 

p.tmp1<-derivative.lsa.combined %>%
filter(focus.title=="LIGHT PA METs") %>%
# filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
# filter(`BMI input`=="Overweight") %>% 
  filter(age.groups.output!="Age 45 49") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario), show.legend = F)+
# facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age")+
ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 plot.title = element_text(face = c("bold")),
                 plot.subtitle = element_text(),
                 strip.text = element_text(size = 7),
                 # axis.title.y = element_text(size=7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
 ggtitle("Summary plot - Mean Elementary Effect by age",subtitle="Male outcomes")

p.tmp2<-plot.df %>% 
 rename("Gender input"="gender.input", "BMI outcome"="BMI output", "BMI input"="bmi.input", "Age input"="age.groups.input") %>%
filter(focus.title=="LIGHT PA METs") %>%
# filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
# filter(`BMI input`=="Overweight") %>%
filter(`Age output`!="Age 45 49") %>% 
mutate(prop=((input.value/initial.input)-1)*100)%>% 
ggplot()+
  geom_smooth(aes(x=prop, y=diff, color=scenario), se=F, linewidth=0.5)+
 facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  facet_wrap(vars(`Age output`), scales="free", ncol = 4, nrow=3)+
guides(colour = guide_legend("Scenario"),
       linetype = guide_legend("Scenario"),
       alpha = guide_legend("Scenario"))+
scale_y_continuous(labels = scales::percent)+
scale_x_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1), limits = c(-20, 20),
                   sec.axis = sec_axis(~(.+100)*1.815/100, name = "MET", labels = scales::label_number(suffix = "")))+
ggtitle("Individual relationships", subtitle = "Prevalence of obesity vs Light physical activitiy METs")+
ylab("Change in the prevalence of obesity (%)")+xlab("Percentage change in assumed Light physical activitiy METs")+
    theme_bw() +theme(legend.position = "bottom",
                    panel.spacing.y =unit(0, "mm"),
                    panel.spacing.x =unit(4, "mm"),
                    plot.title = element_text(face = c("bold")),
                    plot.subtitle = element_text())

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)&
# plot_annotation(title = 'Break down of summary results',
#                  theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
theme(legend.position = "bottom")

```



## Light physical activity
**Males**
```{r Light PA male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="LIGHT PA"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing=unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Light physical activity - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing=unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Light physical activity - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r Light PA female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing=unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Light physical activity - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing=unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Light physical activity - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

## Moderate physical activity
**Male**
```{r MODERATE PA male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="MODERATE PA"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Moderate physical activity - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Moderate physical activity - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r MODERATE PA female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Moderate physical activity - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Moderate physical activity - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```


## Vigorour physical activity
**Male**
```{r VIGOROUS PA male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="VIGOROUS PA"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Vigorous physical activity - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Vigorous physical activity - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r VIGOROUS PA female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Vigorous physical activity - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Vigorous physical activity - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```


## Screen time
**Male**
```{r SCREEN TIME male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="SCREEN TIME"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Screen time use - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Screen time use - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r SCREEN TIME female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Screen time use - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Screen time use - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```


## Sleep
**Male**
```{r SLEEP male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="SLEEP"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily minutes of sleep - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily minutes of sleep - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r SLEEP female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily minutes of sleep - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily minutes of sleep - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

## Daily intake of Fruit
**Male**
```{r Fruit male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Fruit"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Fruit - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Fruit - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r Fruit female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Fruit - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing=unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Fruit - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

## Daily intake of Vegetables
**Male**
```{r Vegetables male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Vegetables"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Vegetables - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Vegetables - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r Vegetables female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Vegetables - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Vegetables - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

## Daily intake of Grains 
**Male**
```{r Grains male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Grains"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Grains - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Grains - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r Grains female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Grains - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Grains - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```


## Daily intake of Dairy
**Male**
```{r Dairy male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Dairy"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Dairy - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Dairy - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r Dairy female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Dairy - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Dairy - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

## Daily intake of Protein
**Male**
```{r Meat and Protein male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Meat and Protein"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Meat and Protein - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Meat and Protein - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r Meat and Protein female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Meat and Protein - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Meat and Protein - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

## Daily intake of Discretionary foods
**Male**
```{r Discretionary foods male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Discretionary foods"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Discretionary foods - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Discretionary foods - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r Discretionary foods female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Discretionary foods - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Discretionary foods - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

## Daily intake of Fats and Oils
**Male**
```{r Fats and Oils male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Fats and Oils"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Fats and Oils - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Fats and Oils - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r Fats and Oils female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Fats and Oils - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Fats and Oils - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```


## Daily intake of Sugar based beverages
**Male**
```{r Sugar based beverage male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Sugar based beverage"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Sugar based beverage - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Sugar based beverage - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r Sugar based beverage female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Sugar based beverage - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Sugar based beverage - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

## Daily intake of Water
**Male**
```{r Water male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Water"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Water - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Male') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Water - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Male Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

**Female**
```{r Water female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Water - Intercept")+
  
  
derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
filter(`Gender input`=='Female') %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 strip.text.y = element_text(size = 6),
                 panel.spacing.y =unit(4, "mm"),
                 panel.spacing.x =unit(0, "mm"))+
guides(colour = guide_legend("Scenarios"))+
ggtitle("Daily consumption of Water - Age change")+

plot_layout(ncol=1, nrow = 2, guides = "collect") +
plot_annotation(title = 'Variation in Female Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                               plot.subtitle = element_text(size = 12, hjust = 0.5))) &
theme(legend.position = "bottom")

```

## Initial fat-mass (%)
**Change in Male fat-mass % assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>% 
filter(focus.title=="Initial FM %" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Males")+

derivative.lsa.combined %>%
filter(focus.title=="Initial FM %" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male % Fat-mass',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="Initial FM %" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Females")+

derivative.lsa.combined %>%
filter(focus.title=="Initial FM %" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Females with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male % Fat-mass',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

**Change in Female fat-mass % assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>% 
filter(focus.title=="Initial FM %" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Males")+

derivative.lsa.combined %>%
filter(focus.title=="Initial FM %" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male % Fat-mass',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="Initial FM %" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Females")+

derivative.lsa.combined %>%
filter(focus.title=="Initial FM %" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Females with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male % Fat-mass',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

##  Proportion of nutrients within food group Inputs
**Grains**
```{r Prop of nutrients within food group Grains, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Grains"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Carbohydrates")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Dietary Fats")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Moisture")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Protein")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Sugars")+

plot_layout(nrow = 5, ncol=1, guides = "collect") + 
plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
theme(legend.position = "bottom")

```

**Vegetables**
```{r Prop of nutrients within food group Vegetables, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Vegetables"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Carbohydrates")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Dietary Fats")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Moisture")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Protein")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Sugars")+

plot_layout(nrow = 5, ncol=1, guides = "collect") + 
plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
theme(legend.position = "bottom")

```


**Fruit**
```{r Prop of nutrients within food group Fruit, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Fruit"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Carbohydrates")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Dietary Fats")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Moisture")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Protein")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Sugars")+

plot_layout(nrow = 5, ncol=1, guides = "collect") + 
plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
theme(legend.position = "bottom")
```

**Dairy**
```{r Prop of nutrients within food group Dairy, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Dairy"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Carbohydrates")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Dietary Fats")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Moisture")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Protein")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Sugars")+

plot_layout(nrow = 5, ncol=1, guides = "collect") + 
plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
theme(legend.position = "bottom")
```


**Meat and Protein**
```{r Prop of nutrients within food group Meat, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Meat"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Carbohydrates")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Dietary Fats")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Moisture")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Protein")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Sugars")+

plot_layout(nrow = 5, ncol=1, guides = "collect") + 
plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
theme(legend.position = "bottom")
```

**Fats**
```{r Prop of nutrients within food group Fats, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*5*2.7}
tmp.food.group="Fats"

# derivative.lsa.combined %>%
#   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
#   facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
#   # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("Scenario"))+
#   ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
# scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Dietary Fats")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
# scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Moisture")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
# scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Protein")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
# scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Sugars")+

plot_layout(nrow = 4, ncol=1, guides = "collect") + 
plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
theme(legend.position = "bottom")
```

**Discretionary foods**
```{r Prop of nutrients within food group Discretionary_foods, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Discretionary_foods"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Carbohydrates")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Dietary Fats")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Moisture")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Protein")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Sugars")+

plot_layout(nrow = 5, ncol=1, guides = "collect") + 
plot_annotation(title = paste0('Percentage of macro-nutrients within ',gsub("_", " ",tmp.food.group)),
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
theme(legend.position = "bottom")



```


**Sugar-sweetened beverages**
```{r Prop of nutrients within food group Sugar_Sweetened_beverage, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*2.5*2.7}
tmp.food.group="Sugar_Sweetened_beverage"

# derivative.lsa.combined %>%
#   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
#   facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
#   # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("Scenario"))+
#   ggtitle("Carbohydrates")+
#   
#   derivative.lsa.combined %>%
#    filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
#   facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
#   # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("Scenario"))+
#   ggtitle("Dietary Fats")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Moisture")+

# derivative.lsa.combined %>%
#  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
# filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
# ggplot()+
# geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
# geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
# scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                  labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
# # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
# xlab("Age outcomes")+
# ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
# theme_bw()+theme(legend.position = "bottom",
#                  panel.spacing=unit(0, "mm"),
#                  strip.text = element_text(size = 7),
#                  axis.text.x = element_text(size=6),
#                  axis.text.y = element_text(size=8))+
# guides(colour = guide_legend("Scenario"))+
# ggtitle("Protein")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Sugars")+

plot_layout(nrow = 2, ncol=1, guides = "collect") + 
plot_annotation(title = paste0('Percentage of macro-nutrients within ',"Non-sugar-sweetened beverages"),
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
theme(legend.position = "bottom")



```

**Miscellaneous (Other)**
```{r Prop of nutrients within food group Miscellaneous, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Other"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Carbohydrates")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Dietary Fats")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Moisture")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Protein")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Sugars")+

plot_layout(nrow = 5, ncol=1, guides = "collect") + 
plot_annotation(title = paste0('Percentage of macro-nutrients within ',"Miscellaneous (Other)"),
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
theme(legend.position = "bottom")



```

**Non-sugar-sweetened beverages**
```{r Prop of nutrients within food group NonAlcoholic_beverage, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="NonAlcoholic_beverage"

derivative.lsa.combined %>%
filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Carbohydrates")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Dietary Fats")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Moisture")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Protein")+

derivative.lsa.combined %>%
 filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
# facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.1))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text = element_text(size = 7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Sugars")+

plot_layout(nrow = 5, ncol=1, guides = "collect") + 
plot_annotation(title = paste0('Percentage of macro-nutrients within ',"Non-sugar-sweetened beverages"),
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
theme(legend.position = "bottom")



```

## Initial BMI Prevalence
**Change in Male Initial BMI Prevalence**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>% 
filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Males")+

derivative.lsa.combined %>%
filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Females")+

derivative.lsa.combined %>%
filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Females with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

**Change in Female Initial BMI Prevalence**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>% 
filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Males")+

derivative.lsa.combined %>%
filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Males with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="Overweight") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Overweight Females")+

derivative.lsa.combined %>%
filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
filter(`Gender input`=='Female') %>%
filter(`Gender outcome`=='Female') %>%
filter(`BMI outcome`=="With obesity") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
# facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in BMI", "prevalence from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 axis.title.y =element_blank(),
                 strip.text.x = element_text(size = 6),
                 strip.text.y = element_text(size = 6),
                 axis.text.x = element_text(size=7),
                 axis.text.y = element_text(size=7))+
guides(colour = guide_legend("Scenario"))+
ggtitle("Outcome: Females with obesity")+

plot_layout(nrow = 1, ncol=2, guides = "collect") +
plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                 theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
theme(legend.position = "bottom")
```



# Plots for thesis chapter
### Example of interactions occuring between base model assumptions and interventions
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.2*4*2.5,fig.height=1*5*2.5}
# list.of.focus.variables.levels.plot.search %>% 
# filter(focus.title=="CARBOHYDRATE TEF" )
p.tmp1<-derivative.lsa.combined %>%
filter(focus.title=="PROTEIN TEF" ) %>% 
# filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
# filter(`BMI input`=="Overweight") %>% 
  filter(age.groups.output!="Age 45 49") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1, show.legend = F)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario), show.legend = F)+
# facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                          "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                 labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
xlab("Age")+
ylab(bquote(atop("Average in the change in", " intervention effect(" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"),
                 plot.title = element_text(face = c("bold")),
                 plot.subtitle = element_text(),
                 strip.text = element_text(size = 7),
                 # axis.title.y = element_text(size=7),
                 axis.text.x = element_text(size=6),
                 axis.text.y = element_text(size=8))+
 ggtitle("Summary plot - Mean Elementary Effect by age",subtitle="Impact of intervention on male outcomes")

p.tmp2<-plot.df %>% 
 rename("Gender input"="gender.input", "BMI outcome"="BMI output", "BMI input"="bmi.input", "Age input"="age.groups.input") %>%
filter(focus.title=="PROTEIN TEF" ) %>% 
# filter(`Gender input`=='Male') %>%
filter(`Gender outcome`=='Male') %>%
filter(`BMI outcome`=="With obesity") %>% 
# filter(`BMI input`=="Overweight") %>%
filter(`Age output`!="Age 45 49") %>% 
mutate(prop=((input.value/initial.input)-1)*100)%>% 
ggplot()+
  geom_smooth(aes(x=prop, y=diff, color=scenario), se=F, linewidth=0.5)+
 facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  facet_wrap(vars(`Age output`), scales="free", ncol = 4, nrow=3)+
guides(colour = guide_legend("Scenario"),
       linetype = guide_legend("Scenario"),
       alpha = guide_legend("Scenario"))+
scale_y_continuous(labels = scales::percent)+
scale_x_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1), limits = c(-20, 20),
                 sec.axis = sec_axis(~(.+100)*0.2/100, name = "TEF", labels = scales::label_number(suffix = "")))+
ggtitle("Individual relationships", subtitle = "Prevalence of obesity vs assumed protien (TEF)")+
ylab("Change in the prevalence of obesity (%) from intervention")+xlab("Percentage change in assumed protein (TEF)")+
    theme_bw() +theme(legend.position = "bottom",
                    panel.spacing.y =unit(0, "mm"),
                    panel.spacing.x =unit(4, "mm"),
                    plot.title = element_text(face = c("bold")),
                    plot.subtitle = element_text())

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)&
plot_annotation(title = 'Break down of summary results',
                 theme = theme(plot.title = element_text(size = 16, face = c("bold")))) &
theme(legend.position = "bottom")

```


### Interaction explaination plots
```{r, echo=F, warning=F, error=F, message=F, fig.width=1.3*1*5, fig.height=1*1*5}

tef.0.24.parm=c(2.72071939341,0.261144865645)
tef.0.2.parm=c(2.76415120273,0.271177030566)

ow.cp=18.09
ob.cp=20.9166666667

delta=0.5

dist.test<- data.frame(x=seq(5,35, 0.01)) %>% 
mutate(tef.0.24=dlnorm(x, meanlog=tef.0.24.parm[1], sdlog=tef.0.24.parm[2])) %>% 
mutate(tef.0.24.shading=ifelse(between(x, ob.cp, ob.cp+delta), tef.0.24, 0)) %>% 
mutate(tef.0.2=dlnorm(x,meanlog=tef.0.2.parm[1], sdlog=tef.0.2.parm[2])) %>% 
mutate(tef.0.2.shading=ifelse(between(x, ob.cp, ob.cp+delta), tef.0.2, 0))

dist.test%>% 
ggplot()+
geom_area(aes(x=x, y=tef.0.2.shading, fill="TEF Initial assumption"), alpha=0.3)+
# geom_ribbon(aes(x=x, ymin=tef.0.2.shading, ymax=tef.0.24.shading, fill="TEF Initial assumption"), alpha=0.3)+
geom_area(aes(x=x, y=tef.0.24.shading, fill="TEF extreme condition"), alpha=0.3)+
geom_line(aes(x=x, y=tef.0.24, color="TEF extreme condition"))+
geom_line(aes(x=x, y=tef.0.2, color="TEF Initial assumption"))+
geom_segment(aes(x = ob.cp, y =0, xend = ob.cp, yend = dlnorm(ob.cp,meanlog=tef.0.2.parm[1], sdlog=tef.0.2.parm[2])), color="grey40", linetype="dashed")+
geom_segment(aes(x = ow.cp, y =0, xend = ow.cp, yend = dlnorm(ow.cp,meanlog=tef.0.2.parm[1], sdlog=tef.0.2.parm[2])), color="grey40",linetype="dashed")+
scale_fill_manual(values=c("red", "blue"))+
scale_color_manual(values=c("red", "blue"))+
ylab("Density")+xlab("BMI")+
theme_bw()+
# annotate("text", x = 4, y = 0.075, label = "Some text")+
guides(colour = guide_legend("Distribution", ncol = 1, title.position = "top"),
       fill = guide_legend("Population to migrate", ncol = 1, title.position = "top"))+
theme(legend.position = "bottom")+
    labs(caption = "*age-gender specific BMI cutpoints (Cole et al, 2000)")


# y.10 case
# plnorm(ob.cp-delta, meanlog=y.10.parm[1], sdlog=y.10.parm[2])-plnorm(ob.cp, meanlog=y.10.parm[1], sdlog=y.10.parm[2])
# 
# (plnorm(ob.cp-delta, meanlog=y.10.parm[1], sdlog=y.10.parm[2])-plnorm(ob.cp, meanlog=y.10.parm[1], sdlog=y.10.parm[2]))/plnorm(ob.cp, meanlog=y.10.parm[1], sdlog=y.10.parm[2])
# 
# # y.20 case
# plnorm(ob.cp-delta, meanlog=y.20.parm[1], sdlog=y.20.parm[2])-plnorm(ob.cp, meanlog=y.20.parm[1], sdlog=y.20.parm[2])
# 
# (plnorm(ob.cp-delta, meanlog=y.20.parm[1], sdlog=y.20.parm[2])-plnorm(ob.cp, meanlog=y.20.parm[1], sdlog=y.20.parm[2]))/plnorm(ob.cp, meanlog=y.20.parm[1], sdlog=y.20.parm[2])
```


### Policy specific inputs
```{r echo=F, warning=F, error=F, message=F, fig.width=1.6*2*5, fig.height=1*2*5}
tmp.p1<-derivative_lsa_epoch_int %>% 
filter(grepl("Scale up",focus) & bmi.output=="With obesity") %>% mutate(scenario="EPOCH") %>% 
add_case( derivative_lsa_cci_int %>% 
            filter(grepl("Scale up",focus) & bmi.output=="With obesity") %>% mutate(scenario="CCI")) %>% 
add_case( derivative_lsa_si_int %>% 
            filter(grepl("Scale up",focus) & bmi.output=="With obesity") %>% mutate(scenario="SI")) %>% 
  add_case( derivative_lsa_svi_int %>% 
            filter(grepl("Scale up",focus) & bmi.output=="With obesity") %>% mutate(scenario="SVI")) %>% 
  add_case( derivative_lsa_ssb_int %>% 
            filter(grepl("Scale up",focus) & bmi.output=="With obesity") %>% mutate(scenario="SSB")) %>% 
rename("Gender output"="gender.output") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender output`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in prevalence of", "obesity from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"))+
                 # strip.text.x = element_text(size = 6),
                 # strip.text.y = element_text(size = 6),
                 # axis.text.x = element_text(size=7),
                 # axis.text.y = element_text(size=7))+
guides(colour = guide_legend("BMI Outcome"))+
ggtitle("Scenario fidelity")

tmp.p2<-derivative_lsa_epoch_int %>% 
filter(grepl("Relapse Rate EPOCH",focus) & bmi.output=="With obesity") %>% mutate(scenario="EPOCH") %>% 
add_case( derivative_lsa_cci_int %>% 
            filter(grepl("Relapse",focus) & bmi.output=="With obesity") %>% mutate(scenario="CCI")) %>% 
add_case( derivative_lsa_si_int %>% 
            filter(grepl("Relapse",focus) & bmi.output=="With obesity") %>% mutate(scenario="SI")) %>% 
  add_case( derivative_lsa_svi_int %>% 
            filter(grepl("Relapse",focus) & bmi.output=="With obesity") %>% mutate(scenario="SVI")) %>% 
  add_case( derivative_lsa_ssb_int %>% 
            filter(grepl("Relapse",focus) & bmi.output=="With obesity") %>% mutate(scenario="SSB")) %>% 
rename("Gender output"="gender.output") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean.ee.prop.alt, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.prop.alt, color=scenario))+
facet_grid2(col=vars(`Gender output`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
 ylab(bquote(atop("Average change in prevalence of", "obesity from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"))+
                 # strip.text.x = element_text(size = 6),
                 # strip.text.y = element_text(size = 6),
                 # axis.text.x = element_text(size=7),
                 # axis.text.y = element_text(size=7))+
guides(colour = guide_legend("BMI Outcome"))+
ggtitle("Relaspe rate")

tmp.p3<-derivative_lsa_epoch_int %>% ungroup() %>% 
filter(grepl("Percentage of infants exposed",focus) & bmi.output=="With obesity") %>% mutate(scenario="EPOCH") %>% 
group_by(scenario, bmi.output, age.groups.output, gender.output) %>% 
summarise(mean=mean(mean.ee.prop.alt)) %>% ungroup() %>% 
add_case( derivative_lsa_cci_int %>% ungroup() %>% 
            filter(grepl("Percentage",focus) & bmi.output=="With obesity") %>% mutate(scenario="CCI") %>% 
            group_by(scenario, bmi.output, age.groups.output, gender.output) %>% 
            summarise(mean=mean(mean.ee.prop.alt))) %>% 
add_case( derivative_lsa_si_int %>% ungroup() %>% 
filter(grepl("SI Percentage of children attending School",focus) | 
       grepl("SI Percentage of Schools participating in intervention", focus)) %>% 
            filter(grepl("Percentage",focus) & bmi.output=="With obesity") %>% mutate(scenario="SI") %>% 
            group_by(scenario, bmi.output, age.groups.output, gender.output) %>% 
            summarise(mean=mean(mean.ee.prop.alt))) %>% 
add_case(derivative_lsa_svi_int %>% ungroup() %>% 
           filter(grepl("population that Registers for vouchers",focus)) %>% 
            filter(bmi.output=="With obesity") %>% mutate(scenario="SVI") %>% 
           group_by(scenario, bmi.output, age.groups.output, gender.output) %>% 
            summarise(mean=mean(mean.ee.prop.alt))) %>% 
  rename("Gender output"="gender.output") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean, color=scenario))+
facet_grid2(col=vars(`Gender output`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in prevalence of", "obesity from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"))+
                 # strip.text.x = element_text(size = 6),
                 # strip.text.y = element_text(size = 6),
                 # axis.text.x = element_text(size=7),
                 # axis.text.y = element_text(size=7))+
guides(colour = guide_legend("BMI Outcome"))+
ggtitle("Aggregate exposure")+
labs(caption = "*No exposure assumption for SSB \n **Policy scenarios may have multiple exposure assumptions")

tmp.p4<-derivative_lsa_epoch_int %>% 
filter(grepl("Effect",focus)) %>% 
filter(bmi.output=="With obesity") %>% 
mutate(scenario="EPOCH") %>% 
group_by(scenario, bmi.output, age.groups.output, gender.output) %>% 
            summarise(mean=mean(-abs(mean.ee.prop.alt))) %>% ungroup() %>% 
add_case(derivative_lsa_cci_int %>% 
           filter(focus %in% c("Childcare settings intervention Change in Diet coefficients[Discretionary_foods]",
                               "Childcare settings intervention Change in Diet coefficients[Sugar_Sweetened beverage]",
                               "Childcare settings intervention Change in PA coefficients[Light]")) %>% 
           filter(bmi.output=="With obesity") %>%
           mutate(scenario="CCI") %>% 
           select(scenario,focus, bmi.output, gender.output, age.groups.output, mean.ee.prop.alt) %>% 
           group_by(scenario, bmi.output, age.groups.output, gender.output) %>% 
           summarise(mean=mean(mean.ee.prop.alt)) %>% ungroup) %>% 
add_case(derivative_lsa_si_int %>% 
           filter(focus %in% c("SI % Reduction In student Purchases[Discretionary_foods]",
                               "SI % change in PA[Moderate]")) %>% 
           filter(bmi.output=="With obesity") %>%
           mutate(scenario="SI") %>% 
           select(scenario,focus, bmi.output, gender.output, age.groups.output, mean.ee.prop.alt) %>% 
           group_by(scenario, bmi.output, age.groups.output, gender.output) %>% 
           summarise(mean=mean(mean.ee.prop.alt)) %>% ungroup) %>% 
add_case(derivative_lsa_svi_int %>% 
           filter(grepl("Average proportion attributed to vouchers",focus) | 
                  grepl("Average Number of Hours of organised sports or activities Weekly",focus)) %>% 
           filter(bmi.output=="With obesity") %>% 
           mutate(scenario="SVI") %>% 
           select(scenario,focus, bmi.output, gender.output, age.groups.output, mean.ee.prop.alt) %>% 
           group_by(scenario, bmi.output, age.groups.output, gender.output) %>% 
           summarise(mean=mean(mean.ee.prop.alt)) %>% ungroup) %>% 
add_case(derivative_lsa_ssb_int %>% 
           filter(grepl("SSB Tax %",focus) | grepl("PE",focus)) %>% 
           filter(bmi.output=="With obesity") %>% 
           mutate(scenario="SSB") %>% 
           select(scenario,focus, bmi.output, gender.output, age.groups.output, mean.ee.prop.alt) %>% 
           group_by(scenario, bmi.output, age.groups.output, gender.output) %>% 
           # summarise(mean=mean(mean.ee.prop.alt)) %>% ungroup) %>% 
            summarise(mean=mean(-abs(mean.ee.prop.alt))) %>% ungroup()) %>% 
    rename("Gender output"="gender.output") %>% 
ggplot()+
geom_point(aes(x=age.groups.output, y=mean, color=scenario), size=1)+
geom_line(aes(x=as.numeric(age.groups.output), y=mean, color=scenario))+
facet_grid2(col=vars(`Gender output`), scale="free", labeller = label_both, independent = "x")+
scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                 labels=c("3-5", "18-19", "40-44"))+
scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
# scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
xlab("Age outcomes")+
ylab(bquote(atop("Average change in prevalence of", "obesity from intervention (" *mu[EE]*")")))+
# ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
theme_bw()+theme(legend.position = "bottom",
                 panel.spacing=unit(0, "mm"))+
                 # strip.text.x = element_text(size = 6),
                 # strip.text.y = element_text(size = 6),
                 # axis.text.x = element_text(size=7),
                 # axis.text.y = element_text(size=7))+
guides(colour = guide_legend("BMI Outcome"))+
ggtitle("Aggregate health effect")+
labs(caption = "*Policy scenarios may have multiple health effect assumptions")

tmp.p1+tmp.p2+tmp.p3 +tmp.p4+
plot_layout(ncol=2, nrow=2)
```
